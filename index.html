<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script src="./target/ico-min.js" type="text/javascript"></script>
  <script type="text/javascript">
    var canvasWidth = 70;
    var canvasHeight = 40;
    var xOffset = canvasWidth / 2;
    var yOffset = canvasHeight / 2;
    var joints = 1;
    var scale = 15;
    var linksStartRow = 10;
    var linksCharOffset = 40;

    var activeIco;
    var mouseEvent;
    var mousedOver = false;

    var links = [
      {
        text: 'resume',
        url: 'https://www.dropbox.com/s/925fscysji67aun/resume.pdf?dl=1'
      },
      {
        text: 'github',
        url: 'https://github.com/bakks',
      },
      {
        text: 'linkedin',
        url: 'https://linkedin.com/in/pbbakkum'
      },
      {
        text: '@pbbakkum',
        url: 'https://twitter.com/pbbakkum'
      },
      {
        text: '+1 757 812 2365',
        url: 'tel:1-757-812-2365'
      },
      {
        text: 'pbb7c@virginia.edu',
        url: 'mailto:pbb7c@virginia.edu'
      }
    ]

    var gradientStart = '0F75FF';
    var gradientEnd = '0AFF6F';

    var parseHex = function(x) {
      return [
        parseInt(x.substring(0,2), 16),
        parseInt(x.substring(2,4), 16),
        parseInt(x.substring(4,6), 16),
      ]
    }

    Number.prototype.pad = function(size) {
      var s = this.toString(16);
      while (s.length < (size || 2)) {s = "0" + s;}
      return s;
    }

    var hexGradient = function(start, end, position) {
      var startRGB = parseHex(start);
      var endRGB = parseHex(end);
      var result = [];
      for (var i = 0; i < 3; i++) {
        result[i] = Math.round(startRGB[i] + (endRGB[i] - startRGB[i]) * position);
      }
      return result[0].pad() + result[1].pad() + result[2].pad();
    }

    var insertLinks = function(str) {
      var x = [];
      var prev = 0;
      var rowCharWidth = str.search('<br>') + 4;
      var start = rowCharWidth * linksStartRow + linksCharOffset;

      for (var i in links) {
        var text = links[i]['text'];
        var url = links[i]['url'];

        x.push(str.substring(prev, start));
        x.push('<a href="' + url + '" onmousedown="mouseDown()" onmouseover="mouseOver()" onmouseout="mouseOut()">' + text + '</a>');
        prev = start + text.length;

        start += rowCharWidth * 2;
      }
      x.push(str.substring(prev, str.length));
      return x.join('');
    }

    var colorRows = function(str) {
       var x = [];
       var prev = 0;

       for (var i = 0; i < canvasHeight; i++) {
         var color = hexGradient(gradientStart, gradientEnd, i / canvasHeight);
         x.push('<span style="color:#' + color + '">')
         x.push(str.substring(prev, prev + canvasWidth))
         x.push('</span><br>')
         prev += canvasWidth + 4;
       }
       return x.join('');
    }

    var render = function() {
      var str = activeIco.Render()
      str = str.replace(/(?:\r\n|\r|\n)/g, '<br>');
      str = colorRows(str);
      str = insertLinks(str);
      if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {
        str = str.replace(/[â €]/g, '<span style="font-size:0.9em;letter-spacing:0.16em">&nbsp;</span>');
      }
      document.body.innerHTML = str;
    }

    window.onload = function() {
      activeIco = ico.New(canvasWidth, canvasHeight, xOffset, yOffset, joints, scale);
      render()

      window.setInterval(function() {
        if (!mouseEvent) return;

        var posX = mouseEvent.clientX;
        var posY = mouseEvent.clientY;

        if (document.elementFromPoint(posX, posY).tagName != 'A') {
          mousedOver = false;
        }

        var xChange = (posX) / 30000;
        var yChange = (posY) / 30000 * -1;

        xChange *= -1;
        yChange *= -1;

        if (mousedOver) {
          xChange *= -1 * 5;
          yChange *= -1 * 5;
        }

        activeIco.RotateX(xChange);
        activeIco.RotateY(yChange);
        render();
      }, 75)
    }

    var mouseOver = function() {
      mousedOver = true;
    }

    var mouseOut = function() {
      mousedOver = false;
    }

    var mouseDown = function() {
    }

    var mousePosition = function(e) {
      mouseEvent = e;
    }

  </script>

  <style type="text/css">
    body {
      color: #999;
      font-family: Courier;
      background-color: #222;
      width: 100%;
      height: 100%;
    }
    a {
      color: white;
      text-decoration: none;
      font-size:0.9em;
      letter-spacing: 0.16em;
    }
    * {
      margin: 0px;
      padding: 0px;
    }
  </style>
</head>
<body onmousemove="mousePosition(event)">
&nbsp;
</body>
</html>
