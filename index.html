<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script src="./target/ico-min.js" type="text/javascript"></script>
  <script type="text/javascript">
    var canvasWidth = 94;
    var canvasHeight = 60;
    var xOffset = 50;
    var yOffset = canvasHeight / 2 - 20;
    var joints = 1;
    var scale = 20;
    var linksStartRow = 8;
    var linksCharOffset = 65;

    var activeIco;
    var mouseEvent;
    var mousedOver = false;
    var stopRotating = false;

    var links = [
      {
        text: 'resumé',
        url: 'https://www.dropbox.com/s/925fscysji67aun/resume.pdf?dl=1'
      },
      {
        text: 'github',
        url: 'https://github.com/bakks',
      },
      {
        text: 'linkedin',
        url: 'https://linkedin.com/in/pbbakkum'
      },
      {
        text: '@pbbakkum',
        url: 'https://twitter.com/pbbakkum'
      },
      {
        text: 'pbbakkum@gmail.com',
        url: 'mailto:pbbakkum@gmail.com'
      }
    ]

    var gradientStart = '8D54FF';
    var gradientEnd = 'FF5471';

    var parseHex = function(x) {
      return [
        parseInt(x.substring(0,2), 16),
        parseInt(x.substring(2,4), 16),
        parseInt(x.substring(4,6), 16),
      ]
    }

    Number.prototype.pad = function(size) {
      var s = this.toString(16);
      while (s.length < (size || 2)) {s = "0" + s;}
      return s;
    }

    var hexGradient = function(start, end, position) {
      var startRGB = parseHex(start);
      var endRGB = parseHex(end);
      var result = [];
      for (var i = 0; i < 3; i++) {
        result[i] = Math.round(startRGB[i] + (endRGB[i] - startRGB[i]) * position);
      }
      return result[0].pad() + result[1].pad() + result[2].pad();
    }

    var insertLinks = function(str) {
      var x = [];
      var prev = 0;
      var rowCharWidth = str.search('<br>') + 4;
      var start = rowCharWidth * linksStartRow + linksCharOffset;

      for (var i in links) {
        var text = links[i]['text'];
        var url = links[i]['url'];

        x.push(str.substring(prev, start));
        x.push('<a href="' + url + '" onmousedown="mouseDown(event)" onmouseover="mouseOver()" onmouseout="mouseOut()">' + text + '</a>');
        prev = start + text.length;

        start += rowCharWidth * 2;
      }
      x.push(str.substring(prev, str.length));
      return x.join('');
    }

    var colorRows = function(str) {
       var x = [];
       var prev = 0;

       for (var i = 0; i < canvasHeight; i++) {
         var color = hexGradient(gradientStart, gradientEnd, i / canvasHeight * 3.0);
         x.push('<span style="color:#' + color + '; text-shadow: 0.5px 0.5px #a0a0a0;">')
         x.push(str.substring(prev, prev + canvasWidth))
         x.push('</span><br>')
         prev += canvasWidth + 4;
       }
       return x.join('');
    }

    var render = function() {
      var str = activeIco.Render()
      str = str.replace(/(?:\r\n|\r|\n)/g, '<br>');
      str = colorRows(str);
      str = insertLinks(str);
      if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {
        str = str.replace(/[⠀]/g, '<span style="font-size:0.9em;letter-spacing:0.16em">&nbsp;</span>');
      }
      document.body.innerHTML = str;
    }

    window.onload = function() {
      activeIco = ico.New(canvasWidth, canvasHeight, xOffset, yOffset, joints, scale);
      render()

      window.setInterval(function() {
        if (!mouseEvent) return;

        var posX = mouseEvent.clientX;
        var posY = mouseEvent.clientY;

        if (document.elementFromPoint(posX, posY).tagName != 'A') {
          mousedOver = false;
        }

        var xChange = (posX - 400) / 30000;
        var yChange = (posY) / 30000 * -1;

        xChange *= -1;
        yChange *= -1;

        if (mousedOver) {
          xChange *= -1 * 5;
          yChange *= -1 * 5;
        }

        if (!stopRotating) {
          activeIco.RotateX(xChange);
          activeIco.RotateY(yChange);
        }
        render();
      }, 75)
    }

    var mouseOver = function() {
      mousedOver = true;
    }

    var mouseOut = function() {
      mousedOver = false;
    }

    var mouseDown = function(e) {
      url = e.target.getAttribute('href');
      if (e.ctrlKey ||
        e.shiftKey ||
        e.metaKey || // apple
        (e.button && e.button == 1) // middle click, >IE9 + everyone else
      ) {
        window.open(url, '_blank');
        return;
      }

      window.location = url;
      stopRotating = true;
      e.stopPropagation();
    }

    var mousePosition = function(e) {
      mouseEvent = e;
//      var posX = mouseEvent.clientX;
//      var posY = mouseEvent.clientY;
//      var el = document.elementFromPoint(posX, posY);
//
//      if (el.tagName == "SPAN") {
//        el.style.color = '#999999';
//      }
    }

  </script>

  <style type="text/css">
    body {
      color: #999;
      font-family: Courier;
      background-color: #ffffff;
      width: 100%;
      height: 100%;
      font-size: 0.6em;
    }
    a {
      color: black;
      text-decoration: none;
      font-size:0.9em;
      letter-spacing: 0.16em;
      text-shadow:none;
    }
    * {
      margin: 0px;
      padding: 0px;
    }
  </style>
</head>
<body onmousemove="mousePosition(event)">
&nbsp;
</body>
</html>
