<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Virginian: Tablet Reader Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Virginian</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Tablet Reader Functions</div>  </div>
</div>
<div class="contents">
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__reader.html#ga6451f1b2ed82890835304dfa28b58dd7">virg_reader_free</a> (<a class="el" href="structvirginian.html">virginian</a> *v, <a class="el" href="structvirg__reader.html">virg_reader</a> *r)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees the resources used by the reader.  <a href="#ga6451f1b2ed82890835304dfa28b58dd7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__reader.html#ga99a9065e32d6e59e421599ed52c931ae">virg_reader_getrows</a> (<a class="el" href="structvirginian.html">virginian</a> *v, <a class="el" href="structvirg__reader.html">virg_reader</a> *r, unsigned *rows_)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Count the number of result rows still to be read.  <a href="#ga99a9065e32d6e59e421599ed52c931ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__reader.html#ga8703db2abff6a068f0e032813b42a2bc">virg_reader_init</a> (<a class="el" href="structvirginian.html">virginian</a> *v, <a class="el" href="structvirg__reader.html">virg_reader</a> *r, <a class="el" href="structvirg__vm.html">virg_vm</a> *<a class="el" href="vm__gpu_8cu.html#a946d0d35b3bc20faef9b521a79e7e89a">vm</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a result tablet reader.  <a href="#ga8703db2abff6a068f0e032813b42a2bc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__reader.html#gacab24a668844ab54b8b9e1c185ab240f">virg_reader_nexttablet</a> (<a class="el" href="structvirginian.html">virginian</a> *v, <a class="el" href="structvirg__reader.html">virg_reader</a> *r)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Move the reader to the next tablet.  <a href="#gacab24a668844ab54b8b9e1c185ab240f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__reader.html#ga6cd6a8f628268abf736fc4588c6eaf56">virg_reader_print</a> (<a class="el" href="structvirg__reader.html">virg_reader</a> *r)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Print the contents of the reader row buffer to stdout.  <a href="#ga6cd6a8f628268abf736fc4588c6eaf56"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__reader.html#gae6184dd2665c5545077aa778e2d364c7">virg_reader_row</a> (<a class="el" href="structvirginian.html">virginian</a> *v, <a class="el" href="structvirg__reader.html">virg_reader</a> *r)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the next result row.  <a href="#gae6184dd2665c5545077aa778e2d364c7"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga6451f1b2ed82890835304dfa28b58dd7"></a><!-- doxytag: member="free.c::virg_reader_free" ref="ga6451f1b2ed82890835304dfa28b58dd7" args="(virginian *v, virg_reader *r)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_reader_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvirg__reader.html">virg_reader</a> *&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Frees the resources used by the reader. </p>
<p>Closes the reader by unlocking the current tablet in use. This must be called only after virg_tablet_init() and before <a class="el" href="group__database.html#ga8e2d3e3bf58554a5c2b58372c2211b66" title="Close the currently opened database.">virg_db_close()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">r</td><td>Pointer to the reader state </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="free_8c_source.html#l00015">15</a> of file <a class="el" href="free_8c_source.html">free.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordflow">if</span>(r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a> != NULL)
                <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(v, r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a>-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>);

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga99a9065e32d6e59e421599ed52c931ae"></a><!-- doxytag: member="getrows.c::virg_reader_getrows" ref="ga99a9065e32d6e59e421599ed52c931ae" args="(virginian *v, virg_reader *r, unsigned *rows_)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_reader_getrows </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvirg__reader.html">virg_reader</a> *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>rows_</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Count the number of result rows still to be read. </p>
<p>Count the number of rows between the current location of the reader and the last possible row. This function does not advance the reader. This function fails if the reader has not been initialized, and returns the rows found in the unsigned integer pointed to by the 3rd argument.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">r</td><td>Pointer to the reader state </td></tr>
    <tr><td class="paramname">rows</td><td>Pointer to an unsigned int through which the rows found will be returned </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="getrows_8c_source.html#l00019">19</a> of file <a class="el" href="getrows_8c_source.html">getrows.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">unsigned</span> rows = 0;

        <span class="keywordflow">if</span>(r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a> == NULL)
                <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ac21dbbc06d2c74731554f359edd10702" title="used to return a function failure">VIRG_FAIL</a>;

        <span class="comment">// use our own pointer so we don&#39;t advance the reader</span>
        <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *res = r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a>;

        <span class="comment">// iterate to the end of the tablet string</span>
        <span class="keywordflow">while</span>(1) {
                rows += res-&gt;<a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a" title="number of rows stored in this tablet">rows</a>;

                <span class="keywordflow">if</span>(res-&gt;<a class="code" href="structvirg__tablet__meta.html#aba80db72f84483fc51af9e39fe5c3590" title="boolean indicating whether this is the last tablet in the tablet string">last_tablet</a>)
                        <span class="keywordflow">break</span>;

                <a class="code" href="group__database.html#ga78584f2bb7ca78e1cb87378929ce40f2" title="Advance a tablet pointer to the next tablet in its string of tablets.">virg_db_loadnext</a>(v, &amp;res);
        }

        <span class="comment">// subtract the position in the current tablet</span>
        rows -= r-&gt;<a class="code" href="structvirg__reader.html#a6fb34f3a45d5b9dc7a5804a5e0c0720a" title="current result row">row</a>;

        rows_[0] = rows;
        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga8703db2abff6a068f0e032813b42a2bc"></a><!-- doxytag: member="init.c::virg_reader_init" ref="ga8703db2abff6a068f0e032813b42a2bc" args="(virginian *v, virg_reader *r, virg_vm *vm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_reader_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvirg__reader.html">virg_reader</a> *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvirg__vm.html">virg_vm</a> *&#160;</td>
          <td class="paramname"><em>vm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize a result tablet reader. </p>
<p>Initialize a reader object to traverse the results of a query, given its virtual machine state struct. This should only be called with a <a class="el" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> struct once a query that output results is run.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">r</td><td>Pointer to the reader state </td></tr>
    <tr><td class="paramname">id</td><td>Pointer to the virtual machine state containing the result tablets to be read </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="reader_2init_8c_source.html#l00018">18</a> of file <a class="el" href="reader_2init_8c_source.html">init.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        r-&gt;<a class="code" href="structvirg__reader.html#ae8db84ecef576b4d02a698d1f0229b4a" title="virtual machine context from which the results are taken">vm</a> = <a class="code" href="vm__gpu_8cu.html#a946d0d35b3bc20faef9b521a79e7e89a" title="GPU constant memory variable to hold the virtual machine execution context.">vm</a>;

        <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(vm-&gt;<a class="code" href="structvirg__vm.html#adf14bd3fd58a91fa721b5c7ef3d5f9c5" title="pointer to the head node of the result tablet list">head_result</a> == NULL, <span class="stringliteral">&quot;No results\n&quot;</span>);
        <a class="code" href="group__database.html#ga45ebb12f5cd1cb668f06dcc64fd815a0" title="Load a tablet into a slot based on its ID and return a pointer.">virg_db_load</a>(v, vm-&gt;<a class="code" href="structvirg__vm.html#adf14bd3fd58a91fa721b5c7ef3d5f9c5" title="pointer to the head node of the result tablet list">head_result</a>-&gt;<a class="code" href="structvirg__result__node__.html#a9bc7e6a0a08061ee5ae2130c22e55fe4" title="tablet id">id</a>, &amp;r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a>);
        r-&gt;<a class="code" href="structvirg__reader.html#a6fb34f3a45d5b9dc7a5804a5e0c0720a" title="current result row">row</a> = 0;

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="gacab24a668844ab54b8b9e1c185ab240f"></a><!-- doxytag: member="nexttablet.c::virg_reader_nexttablet" ref="gacab24a668844ab54b8b9e1c185ab240f" args="(virginian *v, virg_reader *r)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_reader_nexttablet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvirg__reader.html">virg_reader</a> *&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Move the reader to the next tablet. </p>
<p>Move the reader state onto the next result tablet, resetting the row mark to the beginning of that next tablet. Returns VIRG_FAIL if the reader is already at the last tablet.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">r</td><td>Pointer to the reader state </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="nexttablet_8c_source.html#l00016">16</a> of file <a class="el" href="nexttablet_8c_source.html">nexttablet.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a>-&gt;<a class="code" href="structvirg__tablet__meta.html#aba80db72f84483fc51af9e39fe5c3590" title="boolean indicating whether this is the last tablet in the tablet string">last_tablet</a>, <span class="stringliteral">&quot;Reached the last tablet&quot;</span>);
        r-&gt;<a class="code" href="structvirg__reader.html#a6fb34f3a45d5b9dc7a5804a5e0c0720a" title="current result row">row</a> = 0;

        <span class="keywordflow">return</span> <a class="code" href="group__database.html#ga78584f2bb7ca78e1cb87378929ce40f2" title="Advance a tablet pointer to the next tablet in its string of tablets.">virg_db_loadnext</a>(v, &amp;r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga6cd6a8f628268abf736fc4588c6eaf56"></a><!-- doxytag: member="print.c::virg_reader_print" ref="ga6cd6a8f628268abf736fc4588c6eaf56" args="(virg_reader *r)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_reader_print </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirg__reader.html">virg_reader</a> *&#160;</td>
          <td class="paramname"><em>r</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print the contents of the reader row buffer to stdout. </p>
<p>Print the reader row buffer to stdout after a call to <a class="el" href="group__reader.html#gae6184dd2665c5545077aa778e2d364c7" title="Get the next result row.">virg_reader_row()</a>. This function does not advance the reader to the next row or read the current row, and should only be called after <a class="el" href="group__reader.html#gae6184dd2665c5545077aa778e2d364c7" title="Get the next result row.">virg_reader_row()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">r</td><td>Pointer to the reader state </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="print_8c_source.html#l00015">15</a> of file <a class="el" href="print_8c_source.html">print.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">unsigned</span> i;
        <span class="keyword">static</span> <span class="keywordtype">int</span> colwidth = 10;
        <span class="keywordtype">char</span> *offset = &amp;r-&gt;<a class="code" href="structvirg__reader.html#a14e15bcb913a6821425827a6c06be298" title="buffer to hold the contents of returned rows">buffer</a>[0];

        <span class="comment">// for each column in the result row</span>
        <span class="keywordflow">for</span>(i = 0; i &lt; r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a>-&gt;<a class="code" href="structvirg__tablet__meta.html#aa3595a9a97105ce081422911c30c0269" title="number of fixed-size columns">fixed_columns</a>; i++) {
                <span class="comment">// handle each column type</span>
                <span class="keywordflow">switch</span>(r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a>-&gt;<a class="code" href="structvirg__tablet__meta.html#acc96d33e2a323f0e0b90604e3524c626" title="types of the fixed-size columns">fixed_type</a>[i]) {
                        <span class="keywordflow">case</span> VIRG_INT:
                                printf(<span class="stringliteral">&quot;%*i&quot;</span>, colwidth, ((<span class="keywordtype">int</span>*)offset)[0]);
                                <span class="keywordflow">break</span>;
                        <span class="keywordflow">case</span> VIRG_FLOAT:
                                printf(<span class="stringliteral">&quot;%*.2f&quot;</span>, colwidth, ((<span class="keywordtype">float</span>*)offset)[0]);
                                <span class="keywordflow">break</span>;
                        <span class="keywordflow">case</span> VIRG_INT64:
                                printf(<span class="stringliteral">&quot;%*lli&quot;</span>, colwidth, ((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)offset)[0]);
                                <span class="keywordflow">break</span>;
                        <span class="keywordflow">case</span> VIRG_DOUBLE:
                                printf(<span class="stringliteral">&quot;%*.2f&quot;</span>, colwidth, ((<span class="keywordtype">double</span>*)offset)[0]);
                                <span class="keywordflow">break</span>;
                        <span class="keywordflow">case</span> VIRG_CHAR:
                                printf(<span class="stringliteral">&quot;%*c&quot;</span>, colwidth, offset[0]);
                                <span class="keywordflow">break</span>;
                        <span class="keywordflow">default</span>:
                                <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(1, <span class="stringliteral">&quot;Can&#39;t print that type&quot;</span>)
                }
                <span class="comment">// move to the next area</span>
                offset += r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a>-&gt;<a class="code" href="structvirg__tablet__meta.html#af8affe76f89dd02d3f09a052982ae428" title="size in bytes of each of the fixed-size columns">fixed_stride</a>[i];
        }

        printf(<span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="gae6184dd2665c5545077aa778e2d364c7"></a><!-- doxytag: member="row.c::virg_reader_row" ref="gae6184dd2665c5545077aa778e2d364c7" args="(virginian *v, virg_reader *r)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_reader_row </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvirg__reader.html">virg_reader</a> *&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the next result row. </p>
<p>Get the next result row from the reader and advance the reader to the next row. This function places the content of the row in r-&gt;buffer and it is up to the user to extract individual columns from the buffer. This function handles moving to the next tablet as rows are read, and can be operated in a loop to retrieve every single row until it returns VIRG_FAIL, indicating that the end of the results have been reached. This function should only be called after <a class="el" href="group__reader.html#ga8703db2abff6a068f0e032813b42a2bc" title="Initialize a result tablet reader.">virg_reader_init()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">r</td><td>Pointer to the reader state </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="row_8c_source.html#l00020">20</a> of file <a class="el" href="row_8c_source.html">row.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordflow">if</span>(r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a> == NULL)
                <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ac21dbbc06d2c74731554f359edd10702" title="used to return a function failure">VIRG_FAIL</a>;

        <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *res = r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a>;
        <span class="keywordtype">char</span> *dest = &amp;r-&gt;<a class="code" href="structvirg__reader.html#a14e15bcb913a6821425827a6c06be298" title="buffer to hold the contents of returned rows">buffer</a>[0];
        <span class="keywordtype">unsigned</span> i = 0;
        <span class="keywordtype">char</span> *fixed = (<span class="keywordtype">char</span>*)res + res-&gt;<a class="code" href="structvirg__tablet__meta.html#a7b2629d1c97658c8b7a89dff95a1d52b" title="relative ptr to the beginning of the fixed-column area">fixed_block</a>;

        <span class="comment">// get columns one by one and place entire row in reader buffer</span>
        <span class="keywordflow">for</span>(i = 0; i &lt; res-&gt;fixed_columns; i++) {
                <span class="keywordtype">size_t</span> stride = res-&gt;<a class="code" href="structvirg__tablet__meta.html#af8affe76f89dd02d3f09a052982ae428" title="size in bytes of each of the fixed-size columns">fixed_stride</a>[i];
                <span class="keywordtype">void</span> *src = fixed + res-&gt;<a class="code" href="structvirg__tablet__meta.html#af46cdc848ccee989cf764abb07a9f29a" title="relative pointer from fixed_block indicating the beginning of the column">fixed_offset</a>[i] + stride * r-&gt;<a class="code" href="structvirg__reader.html#a6fb34f3a45d5b9dc7a5804a5e0c0720a" title="current result row">row</a>;
                memcpy(dest, src, stride);
                ((<span class="keywordtype">int</span>*)dest)[0] = ((<span class="keywordtype">int</span>*)dest)[0];
                dest += stride;
        }

        r-&gt;<a class="code" href="structvirg__reader.html#a6fb34f3a45d5b9dc7a5804a5e0c0720a" title="current result row">row</a>++;

        <span class="comment">// check if we&#39;ve reached the end of the tablet</span>
        <span class="keywordflow">if</span>(r-&gt;<a class="code" href="structvirg__reader.html#a6fb34f3a45d5b9dc7a5804a5e0c0720a" title="current result row">row</a> &gt;= res-&gt;<a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a" title="number of rows stored in this tablet">rows</a>) {
                <span class="comment">// if last tablet do nothing</span>
                <span class="keywordflow">if</span>(res-&gt;<a class="code" href="structvirg__tablet__meta.html#aba80db72f84483fc51af9e39fe5c3590" title="boolean indicating whether this is the last tablet in the tablet string">last_tablet</a>) {
                        <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(v, res-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>);
                        r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a> = NULL;
                        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ac21dbbc06d2c74731554f359edd10702" title="used to return a function failure">VIRG_FAIL</a>;
                }
                <span class="comment">// otherwise load the next one</span>
                <span class="keywordflow">else</span>
                        <a class="code" href="group__database.html#ga78584f2bb7ca78e1cb87378929ce40f2" title="Advance a tablet pointer to the next tablet in its string of tablets.">virg_db_loadnext</a>(v, &amp;r-&gt;<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a>);
                r-&gt;<a class="code" href="structvirg__reader.html#a6fb34f3a45d5b9dc7a5804a5e0c0720a" title="current result row">row</a> = 0;
        }

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Feb 15 2012 01:21:46 for Virginian by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
