<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Virginian: Table Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Virginian</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Table Functions</div>  </div>
</div>
<div class="contents">
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__table.html#gabe254310e06db8843964bfed82dd4d67">virg_table_addcolumn</a> (<a class="el" href="structvirginian.html">virginian</a> *v, unsigned table_id, const char *name, <a class="el" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b">virg_t</a> type)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a column to every tablet in the table.  <a href="#gabe254310e06db8843964bfed82dd4d67"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__table.html#gabd464f256a1d2645488e015f4a6da1b3">virg_table_create</a> (<a class="el" href="structvirginian.html">virginian</a> *v, const char *name, <a class="el" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b">virg_t</a> key_type)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new table.  <a href="#gabd464f256a1d2645488e015f4a6da1b3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__table.html#ga9232ad719d86ce12da634af477c0181d">virg_table_getcolumn</a> (<a class="el" href="structvirginian.html">virginian</a> *v, unsigned tid, const char *name, unsigned *id)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the ID of a table column given its name.  <a href="#ga9232ad719d86ce12da634af477c0181d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__table.html#ga04c8f0729122ef8406e1a6c918bc4da6">virg_table_getcolumntype</a> (<a class="el" href="structvirginian.html">virginian</a> *v, unsigned tid, unsigned cid, <a class="el" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b">virg_t</a> *type)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the type of a table column.  <a href="#ga04c8f0729122ef8406e1a6c918bc4da6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__table.html#gae353f4b3d8c2a907abc94a1e9dd33a55">virg_table_getid</a> (<a class="el" href="structvirginian.html">virginian</a> *v, const char *name, unsigned *id)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the ID of a table given its name.  <a href="#gae353f4b3d8c2a907abc94a1e9dd33a55"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__table.html#ga94b2fe975e966c73b9790562c9004e35">virg_table_getkeytype</a> (<a class="el" href="structvirginian.html">virginian</a> *v, unsigned tid, <a class="el" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b">virg_t</a> *type)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the type of a table's key.  <a href="#ga94b2fe975e966c73b9790562c9004e35"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__table.html#ga485a975e2aeb00880732eac8c6ad28ee">virg_table_insert</a> (<a class="el" href="structvirginian.html">virginian</a> *v, unsigned table_id, char *key, char *data, char *blob)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Insert a row into a table.  <a href="#ga485a975e2aeb00880732eac8c6ad28ee"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__table.html#gab12cd9a6b1b3e72b9ebe90348cf3cb8c">virg_table_loadmem</a> (<a class="el" href="structvirginian.html">virginian</a> *v, unsigned table_id)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Load as many tablets from a table into memory as possible.  <a href="#gab12cd9a6b1b3e72b9ebe90348cf3cb8c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__table.html#ga8a997c77187e090360e92c200f2249cf">virg_table_numrows</a> (<a class="el" href="structvirginian.html">virginian</a> *v, unsigned id, unsigned *rows)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterate over each table in the database to find the one who's name matches the given string. If no such table is found, the function returns VIRG_FAIL, otherwise the unsigned integer pointed to by the 3rd argument is set to the table's id.  <a href="#ga8a997c77187e090360e92c200f2249cf"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gabe254310e06db8843964bfed82dd4d67"></a><!-- doxytag: member="addcolumn.c::virg_table_addcolumn" ref="gabe254310e06db8843964bfed82dd4d67" args="(virginian *v, unsigned table_id, const char *name, virg_t type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_table_addcolumn </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>table_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b">virg_t</a>&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a column to every tablet in the table. </p>
<p>This function adds a column to a table by iterating over every table in the table and calling <a class="el" href="group__tablet.html#gad8e8dfe554d09257dbccd44b7bc35f2c" title="Add a column to a tablet.">virg_tablet_addcolumn()</a>. This is not a thread-safe function.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">table_id</td><td>Table to which the column is added </td></tr>
    <tr><td class="paramname">name</td><td>Name of the column </td></tr>
    <tr><td class="paramname">type</td><td>The variable type of the column </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="addcolumn_8c_source.html#l00018">18</a> of file <a class="el" href="addcolumn_8c_source.html">addcolumn.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab;

        <span class="comment">// check that the name isn&#39;t too long</span>
        <span class="keywordtype">int</span> i;
        <span class="keywordflow">for</span>(i = 0; name[i] != <span class="charliteral">&#39;\0&#39;</span> &amp;&amp; i &lt; <a class="code" href="virginian_8h.html#a2cccd75830388d7a23d0dc8dca454f57" title="maximum column name length supported">VIRG_MAX_COLUMN_NAME</a>; i++);
        <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(i == VIRG_MAX_COLUMN_NAME, <span class="stringliteral">&quot;Column name too long&quot;</span>);

        <span class="comment">// load the first table of the table into memory</span>
        <a class="code" href="group__database.html#ga45ebb12f5cd1cb668f06dcc64fd815a0" title="Load a tablet into a slot based on its ID and return a pointer.">virg_db_load</a>(v, v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>.<a class="code" href="structvirg__db.html#a1e3f0138b4b0b6b9e631fae4dad9f7a1" title="maps table id to the id of its first tablet">first_tablet</a>[table_id], &amp;tab);

        <span class="comment">// iterate over every tablet of the table</span>
        <span class="keywordflow">while</span>(1) {
                <a class="code" href="group__tablet.html#gad8e8dfe554d09257dbccd44b7bc35f2c" title="Add a column to a tablet.">virg_tablet_addcolumn</a>(tab, name, type);

                <span class="keywordflow">if</span>(tab-&gt;<a class="code" href="structvirg__tablet__meta.html#aba80db72f84483fc51af9e39fe5c3590" title="boolean indicating whether this is the last tablet in the tablet string">last_tablet</a>)
                        <span class="keywordflow">break</span>;

                <a class="code" href="group__database.html#ga78584f2bb7ca78e1cb87378929ce40f2" title="Advance a tablet pointer to the next tablet in its string of tablets.">virg_db_loadnext</a>(v, &amp;tab);
        }

        <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(v, tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>);

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="gabd464f256a1d2645488e015f4a6da1b3"></a><!-- doxytag: member="create.c::virg_table_create" ref="gabd464f256a1d2645488e015f4a6da1b3" args="(virginian *v, const char *name, virg_t key_type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_table_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b">virg_t</a>&#160;</td>
          <td class="paramname"><em>key_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a new table. </p>
<p>Create and add a new table to the database. When a table is created, only its name and the type of its primary key must be specified. The table can be given more structure later with <a class="el" href="group__table.html#gabe254310e06db8843964bfed82dd4d67" title="Add a column to every tablet in the table.">virg_table_addcolumn()</a>. This function is responble for setting the appropriate meta information in the <a class="el" href="structvirg__db.html" title="State of the currently open database.">virg_db</a> struct and creating an empty tablet which is set to both the head and tail of the tablet string.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">name</td><td>Name of the table </td></tr>
    <tr><td class="paramname">key_type</td><td>The variable type of the table primary key column </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="table_2create_8c_source.html#l00020">20</a> of file <a class="el" href="table_2create_8c_source.html">create.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="structvirg__db.html" title="State of the currently open database.">virg_db</a> *db = &amp;v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>;

        <span class="keywordtype">unsigned</span> table_id;

        <span class="comment">// find an empty table slot</span>
        <span class="keywordflow">for</span>(table_id = 0; table_id &lt; <a class="code" href="virginian_8h.html#a6b400ca21647bb81159b1c459ef053e2" title="maximum tables supported">VIRG_MAX_TABLES</a>; table_id++)
                <span class="keywordflow">if</span>(db-&gt;<a class="code" href="structvirg__db.html#a5f9dfe5476b490458ef529b57508cfb2" title="note which table slots have been used">table_status</a>[table_id] == 0)
                        <span class="keywordflow">break</span>;
        <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(table_id == VIRG_MAX_TABLES, <span class="stringliteral">&quot;Too many tables&quot;</span>)
        db-&gt;table_status[table_id] = 1;

        <span class="comment">// copy the table name string</span>
        <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(strlen(name) &gt;= <a class="code" href="virginian_8h.html#a3dc8d40b3fe67f3576cf3e6336efdcdf" title="maximum table name length supported">VIRG_MAX_TABLE_NAME</a>, &quot;Table name too <span class="keywordtype">long</span>&quot;)
        strcpy(&amp;db-&gt;tables[table_id][0], name);

        <span class="keywordtype">int</span> tablet_id;

        <span class="comment">// create an empty tablet</span>
        <a class="code" href="group__tablet.html#gac81bdeda780fac6917c8942bec57a581" title="Create an empty tablet for a new table.">virg_tablet_create</a>(v, &amp;tablet_id, key_type, table_id);

        <span class="comment">// initialize the table elements</span>
        db-&gt;first_tablet[table_id] = tablet_id;
        db-&gt;last_tablet[table_id] = tablet_id;
        db-&gt;write_cursor[table_id] = tablet_id;
        db-&gt;table_tablets[table_id]++;

        return <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga9232ad719d86ce12da634af477c0181d"></a><!-- doxytag: member="getcolumn.c::virg_table_getcolumn" ref="ga9232ad719d86ce12da634af477c0181d" args="(virginian *v, unsigned tid, const char *name, unsigned *id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_table_getcolumn </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the ID of a table column given its name. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">tid</td><td>ID of the table of the column </td></tr>
    <tr><td class="paramname">name</td><td>Name of the column </td></tr>
    <tr><td class="paramname">id</td><td>Pointer to an unsigned integer through which the id is returned </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="getcolumn_8c_source.html#l00015">15</a> of file <a class="el" href="getcolumn_8c_source.html">getcolumn.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab;

        <a class="code" href="group__database.html#ga45ebb12f5cd1cb668f06dcc64fd815a0" title="Load a tablet into a slot based on its ID and return a pointer.">virg_db_load</a>(v, v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>.<a class="code" href="structvirg__db.html#a1e3f0138b4b0b6b9e631fae4dad9f7a1" title="maps table id to the id of its first tablet">first_tablet</a>[tid], &amp;tab);

        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i = 0; i &lt; tab-&gt;<a class="code" href="structvirg__tablet__meta.html#aa3595a9a97105ce081422911c30c0269" title="number of fixed-size columns">fixed_columns</a>; i++)
        {
                <span class="keywordflow">if</span>(strcmp(&amp;tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a230698c2f9081565d75603aa5fa61ba0" title="name of each of the fixed-size columns">fixed_name</a>[i][0], name) == 0) {
                        <span class="keywordtype">id</span>[0] = i;
                        <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(v, tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>);
                        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
                }
        }

        <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(v, tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>);

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ac21dbbc06d2c74731554f359edd10702" title="used to return a function failure">VIRG_FAIL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga04c8f0729122ef8406e1a6c918bc4da6"></a><!-- doxytag: member="getcolumntype.c::virg_table_getcolumntype" ref="ga04c8f0729122ef8406e1a6c918bc4da6" args="(virginian *v, unsigned tid, unsigned cid, virg_t *type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_table_getcolumntype </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b">virg_t</a> *&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the type of a table column. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">tid</td><td>ID of the table of the column </td></tr>
    <tr><td class="paramname">cid</td><td>ID of the column </td></tr>
    <tr><td class="paramname">type</td><td>Pointer to a data type variable through which the result is returned </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="getcolumntype_8c_source.html#l00015">15</a> of file <a class="el" href="getcolumntype_8c_source.html">getcolumntype.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab;

        <a class="code" href="group__database.html#ga45ebb12f5cd1cb668f06dcc64fd815a0" title="Load a tablet into a slot based on its ID and return a pointer.">virg_db_load</a>(v, v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>.<a class="code" href="structvirg__db.html#a1e3f0138b4b0b6b9e631fae4dad9f7a1" title="maps table id to the id of its first tablet">first_tablet</a>[tid], &amp;tab);
        type[0] = tab-&gt;<a class="code" href="structvirg__tablet__meta.html#acc96d33e2a323f0e0b90604e3524c626" title="types of the fixed-size columns">fixed_type</a>[cid];
        <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(v, tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>);

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="gae353f4b3d8c2a907abc94a1e9dd33a55"></a><!-- doxytag: member="getid.c::virg_table_getid" ref="gae353f4b3d8c2a907abc94a1e9dd33a55" args="(virginian *v, const char *name, unsigned *id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_table_getid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the ID of a table given its name. </p>
<p>Iterate over each table in the database to find the one who's name matches the given string. If no such table is found, the function returns VIRG_FAIL, otherwise the unsigned integer pointed to by the 3rd argument is set to the table's id.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">name</td><td>Name of the table </td></tr>
    <tr><td class="paramname">id</td><td>Pointer to an unsigned integer through which the id is returned </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="getid_8c_source.html#l00018">18</a> of file <a class="el" href="getid_8c_source.html">getid.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i = 0; i &lt; <a class="code" href="virginian_8h.html#a6b400ca21647bb81159b1c459ef053e2" title="maximum tables supported">VIRG_MAX_TABLES</a>; i++) {
                <span class="keywordflow">if</span>(v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>.<a class="code" href="structvirg__db.html#a5f9dfe5476b490458ef529b57508cfb2" title="note which table slots have been used">table_status</a>[i] &gt; 0 &amp;&amp; strcmp(name, &amp;v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>.<a class="code" href="structvirg__db.html#a581c152d798171bbe487a67b4e2d1471" title="maps table id to name">tables</a>[i][0]) == 0) {
                        <span class="keywordtype">id</span>[0] = i;
                        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
                }
        }

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ac21dbbc06d2c74731554f359edd10702" title="used to return a function failure">VIRG_FAIL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga94b2fe975e966c73b9790562c9004e35"></a><!-- doxytag: member="getkeytype.c::virg_table_getkeytype" ref="ga94b2fe975e966c73b9790562c9004e35" args="(virginian *v, unsigned tid, virg_t *type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_table_getkeytype </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b">virg_t</a> *&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the type of a table's key. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">tid</td><td>ID of the table of the column </td></tr>
    <tr><td class="paramname">type</td><td>Pointer to a data type variable through which the result is returned </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="getkeytype_8c_source.html#l00013">13</a> of file <a class="el" href="getkeytype_8c_source.html">getkeytype.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab;

        <a class="code" href="group__database.html#ga45ebb12f5cd1cb668f06dcc64fd815a0" title="Load a tablet into a slot based on its ID and return a pointer.">virg_db_load</a>(v, v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>.<a class="code" href="structvirg__db.html#a1e3f0138b4b0b6b9e631fae4dad9f7a1" title="maps table id to the id of its first tablet">first_tablet</a>[tid], &amp;tab);
        type[0] = tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a21626738f2e3e000d376a912558130fa" title="variable type of the key column">key_type</a>;
        <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(v, tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>);

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga485a975e2aeb00880732eac8c6ad28ee"></a><!-- doxytag: member="insert.c::virg_table_insert" ref="ga485a975e2aeb00880732eac8c6ad28ee" args="(virginian *v, unsigned table_id, char *key, char *data, char *blob)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_table_insert </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>table_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>blob</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Insert a row into a table. </p>
<p>Insert a new row by adding it to the end of a table. This function locates the tablet where we have set the write_cursor. If the tablet is full, we attempt to add more row space with <a class="el" href="group__tablet.html#gad8a1519a69a43f924a94cec0a691392c" title="Add fixed-size rows to a tablet.">virg_tablet_addrows()</a>, and if we can't, then we move onto the next tablet in the tablet string. The key and data arguments are passed as pointers to their buffer because the size of their variable types is unknown. The data buffer should contain all the columns in order immediately adjacent to each other. For example, the following code adds a row to a table with an integer key, and an integer, double, and float column:</p>
<div class="fragment"><pre class="fragment"> <span class="keywordtype">int</span> i = 150;
 <span class="keywordtype">char</span> buff[<span class="keyword">sizeof</span>(int) + <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) + <span class="keyword">sizeof</span>(float)];
 <span class="keywordtype">char</span> *x = &amp;buff[0];
 ((<span class="keywordtype">int</span>*)x)[0] = 100;
 x += <span class="keyword">sizeof</span>(int);
 ((<span class="keywordtype">double</span>*)x)[0] = 100.0;
 x += <span class="keyword">sizeof</span>(double);
 ((<span class="keywordtype">float</span>*)x)[0] = 100.0;
 <a class="code" href="group__table.html#ga485a975e2aeb00880732eac8c6ad28ee" title="Insert a row into a table.">virg_table_insert</a>(v, table_id, &amp;i, &amp;buff[0], NULL);
</pre></div><dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">table_id</td><td>Table in which to insert the row </td></tr>
    <tr><td class="paramname">key</td><td>Buffer containing the key value for this row </td></tr>
    <tr><td class="paramname">data</td><td>Buffer containing the row data </td></tr>
    <tr><td class="paramname">blob</td><td>Buffer containing variable size data associated with the key (unimplemented) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="insert_8c_source.html#l00038">38</a> of file <a class="el" href="insert_8c_source.html">insert.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="comment">// TODO add support for blob ptr</span>
        <span class="keywordtype">unsigned</span> i;
        <span class="keywordtype">size_t</span> stride;
        <span class="keywordtype">char</span> *dest;
        <span class="keywordtype">char</span> *src = data;
        <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab;

        assert(blob == NULL);

        <span class="comment">// load the table&#39;s table on which we have a write cursor</span>
        <a class="code" href="group__database.html#ga45ebb12f5cd1cb668f06dcc64fd815a0" title="Load a tablet into a slot based on its ID and return a pointer.">virg_db_load</a>(v, v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>.<a class="code" href="structvirg__db.html#aab4e0db684c30a32f0cc82f25274c576" title="tablet id of the current write location for adding rows to a table">write_cursor</a>[table_id], &amp;tab);

        <span class="comment">// check for corruption</span>
        assert(tab-&gt;<a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a" title="number of rows stored in this tablet">rows</a> &lt;= tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a785691ca2a53ec6a5d5c34bca74c882d" title="fixed-size rows that can be in this tablet without reorganizing columns">possible_rows</a>);

        <span class="comment">// if the current tablet is full</span>
        <span class="keywordflow">if</span>(tab-&gt;<a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a" title="number of rows stored in this tablet">rows</a> == tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a785691ca2a53ec6a5d5c34bca74c882d" title="fixed-size rows that can be in this tablet without reorganizing columns">possible_rows</a>) {
                <span class="comment">// if there is room to add more fixed-size rows</span>
                <span class="keywordflow">if</span>(tab-&gt;<a class="code" href="structvirg__tablet__meta.html#ad65a3feff0d4d970d956214bc658a962" title="total size of this tablet">size</a> &lt; <a class="code" href="virginian_8h.html#a2ac1573feba851890134cec421e2e763" title="size of tablets, must be equal for the db file and the database">VIRG_TABLET_SIZE</a> - tab-&gt;<a class="code" href="structvirg__tablet__meta.html#ae0d98c019521326affbcab24362a7c71" title="stride of fixed-size columns, including key and key pointer">row_stride</a>)
                        <a class="code" href="group__tablet.html#gad8a1519a69a43f924a94cec0a691392c" title="Add fixed-size rows to a tablet.">virg_tablet_addrows</a>(v, tab, <a class="code" href="virginian_8h.html#a83afecb586f9f21f3f2d4d8d961b0535" title="rows to add when a tablet is full and rows still need to be added">VIRG_TABLET_KEY_INCREMENT</a>);
                <span class="comment">// otherwise move on to the next tablet</span>
                <span class="keywordflow">else</span> {
                        <a class="code" href="group__database.html#ga78584f2bb7ca78e1cb87378929ce40f2" title="Advance a tablet pointer to the next tablet in its string of tablets.">virg_db_loadnext</a>(v, &amp;tab);
                        v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>.<a class="code" href="structvirg__db.html#aab4e0db684c30a32f0cc82f25274c576" title="tablet id of the current write location for adding rows to a table">write_cursor</a>[tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a67c202be23e22fae83de9639b3b80110" title="id of the table that this tablet is a part of, if applicable">table_id</a>] = tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>;
                }
        }

        <span class="comment">// copy key from buffer</span>
        <span class="keywordtype">char</span> *fixed_ptr = (<span class="keywordtype">char</span>*)tab + tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a7b2629d1c97658c8b7a89dff95a1d52b" title="relative ptr to the beginning of the fixed-column area">fixed_block</a>;
        <span class="keywordtype">char</span> *key_ptr = (<span class="keywordtype">char</span>*)tab + tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a381166a5323a226a9cf70a527e9f7876" title="relative ptr to the beginning of the key column">key_block</a> + tab-&gt;<a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a" title="number of rows stored in this tablet">rows</a> * tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a16e649bf6f3217270c3fe84fe4d00114" title="stride of the variable type of the key column">key_stride</a>;
        memcpy(key_ptr, key, tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a16e649bf6f3217270c3fe84fe4d00114" title="stride of the variable type of the key column">key_stride</a>);

        assert(tab-&gt;<a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a" title="number of rows stored in this tablet">rows</a> &lt; tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a785691ca2a53ec6a5d5c34bca74c882d" title="fixed-size rows that can be in this tablet without reorganizing columns">possible_rows</a>);

        <span class="comment">// copy over all columns from buffer</span>
        <span class="keywordflow">for</span>(i = 0; i &lt; tab-&gt;<a class="code" href="structvirg__tablet__meta.html#aa3595a9a97105ce081422911c30c0269" title="number of fixed-size columns">fixed_columns</a>; i++) {
                stride = tab-&gt;<a class="code" href="structvirg__tablet__meta.html#af8affe76f89dd02d3f09a052982ae428" title="size in bytes of each of the fixed-size columns">fixed_stride</a>[i];
                dest = fixed_ptr +
                        tab-&gt;<a class="code" href="structvirg__tablet__meta.html#af46cdc848ccee989cf764abb07a9f29a" title="relative pointer from fixed_block indicating the beginning of the column">fixed_offset</a>[i] + tab-&gt;<a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a" title="number of rows stored in this tablet">rows</a> * stride;
                memcpy(dest, src, stride);
                src += stride;
        }

        tab-&gt;<a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a" title="number of rows stored in this tablet">rows</a>++;

        <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(v, tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>);

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="gab12cd9a6b1b3e72b9ebe90348cf3cb8c"></a><!-- doxytag: member="loadtomem.c::virg_table_loadmem" ref="gab12cd9a6b1b3e72b9ebe90348cf3cb8c" args="(virginian *v, unsigned table_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_table_loadmem </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>table_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Load as many tablets from a table into memory as possible. </p>
<p>Fill up a maximum of half of the memory allocated tablet slots with tablets from a table. This is useful for guaranteeing that tablets are in memory before executing a query.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">table_id</td><td>ID of the table to load </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="loadtomem_8c_source.html#l00016">16</a> of file <a class="el" href="loadtomem_8c_source.html">loadtomem.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">unsigned</span> max_tablets = <a class="code" href="virginian_8h.html#a9c6e6ed866369d7cc0288fafd223a87b" title="tablet slots to allocate in memory">VIRG_MEM_TABLETS</a> / 2;
        <span class="keywordtype">unsigned</span> i;
        <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab;

        <span class="comment">// load the first tablet from the string</span>
        <a class="code" href="group__database.html#ga45ebb12f5cd1cb668f06dcc64fd815a0" title="Load a tablet into a slot based on its ID and return a pointer.">virg_db_load</a>(v, v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>.<a class="code" href="structvirg__db.html#a1e3f0138b4b0b6b9e631fae4dad9f7a1" title="maps table id to the id of its first tablet">first_tablet</a>[table_id], &amp;tab);
        <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(v, tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>);

        <span class="comment">// load tablets until we hit max_tablets</span>
        <span class="keywordflow">for</span>(i = 1; i &lt; max_tablets &amp;&amp; !tab-&gt;<a class="code" href="structvirg__tablet__meta.html#aba80db72f84483fc51af9e39fe5c3590" title="boolean indicating whether this is the last tablet in the tablet string">last_tablet</a>; i++) {
                <a class="code" href="group__database.html#ga45ebb12f5cd1cb668f06dcc64fd815a0" title="Load a tablet into a slot based on its ID and return a pointer.">virg_db_load</a>(v, tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a08bff8a2b2cbe7abbbdb0e85a530b065" title="id of the next tablet in the tablet string">next</a>, &amp;tab);
                <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(v, tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>);
        }

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga8a997c77187e090360e92c200f2249cf"></a><!-- doxytag: member="numrows.c::virg_table_numrows" ref="ga8a997c77187e090360e92c200f2249cf" args="(virginian *v, unsigned id, unsigned *rows)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_table_numrows </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>rows</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Iterate over each table in the database to find the one who's name matches the given string. If no such table is found, the function returns VIRG_FAIL, otherwise the unsigned integer pointed to by the 3rd argument is set to the table's id. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="numrows_8c_source.html#l00016">16</a> of file <a class="el" href="numrows_8c_source.html">numrows.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">unsigned</span> i = 0;
        <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab;

        <span class="keywordtype">unsigned</span> tab_id = v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>.<a class="code" href="structvirg__db.html#a1e3f0138b4b0b6b9e631fae4dad9f7a1" title="maps table id to the id of its first tablet">first_tablet</a>[id];

        <a class="code" href="group__database.html#ga45ebb12f5cd1cb668f06dcc64fd815a0" title="Load a tablet into a slot based on its ID and return a pointer.">virg_db_load</a>(v, tab_id, &amp;tab);
        i += tab-&gt;<a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a" title="number of rows stored in this tablet">rows</a>;

        <span class="keywordflow">while</span>(!tab-&gt;<a class="code" href="structvirg__tablet__meta.html#aba80db72f84483fc51af9e39fe5c3590" title="boolean indicating whether this is the last tablet in the tablet string">last_tablet</a>) {
                <a class="code" href="group__database.html#ga78584f2bb7ca78e1cb87378929ce40f2" title="Advance a tablet pointer to the next tablet in its string of tablets.">virg_db_loadnext</a>(v, &amp;tab);
                i += tab-&gt;<a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a" title="number of rows stored in this tablet">rows</a>;
        }

        <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(v, tab-&gt;<a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>);

        rows[0] = i;

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Feb 15 2012 01:21:46 for Virginian by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
