<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Virginian: Virginian Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Virginian</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Virginian Functions</div>  </div>
</div>
<div class="contents">
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__virginian.html#ga0a9d19e23195be294f562b4ab50dc36e">virg_close</a> (<a class="el" href="structvirginian.html">virginian</a> *v)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes the Virginian database by freeing allocations.  <a href="#ga0a9d19e23195be294f562b4ab50dc36e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__virginian.html#gad957409ab5af42ef4fb567ca386880a0">virg_init</a> (<a class="el" href="structvirginian.html">virginian</a> *v)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the Virginian database.  <a href="#gad957409ab5af42ef4fb567ca386880a0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__virginian.html#gaebf521b283ccb4f30d25c69bcdb5cf7c">virg_query</a> (<a class="el" href="structvirginian.html">virginian</a> *v, <a class="el" href="structvirg__reader.html">virg_reader</a> **reader, const char *query)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes a SQL query.  <a href="#gaebf521b283ccb4f30d25c69bcdb5cf7c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__virginian.html#ga4016938c51ab476124eb67d93dc2f994">virg_release</a> (<a class="el" href="structvirginian.html">virginian</a> *v, <a class="el" href="structvirg__reader.html">virg_reader</a> *reader)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleans up after a SQL query.  <a href="#ga4016938c51ab476124eb67d93dc2f994"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__virginian.html#gafd19659c526da8b2d82fd4ca0167a28f">virg_sql</a> (<a class="el" href="structvirginian.html">virginian</a> *v, const char *querystr, <a class="el" href="structvirg__vm.html">virg_vm</a> *<a class="el" href="vm__gpu_8cu.html#a946d0d35b3bc20faef9b521a79e7e89a">vm</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses a SQL query.  <a href="#gafd19659c526da8b2d82fd4ca0167a28f"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga0a9d19e23195be294f562b4ab50dc36e"></a><!-- doxytag: member="close.c::virg_close" ref="ga0a9d19e23195be294f562b4ab50dc36e" args="(virginian *v)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Closes the Virginian database by freeing allocations. </p>
<p>Frees all of the allocations made in <a class="el" href="group__virginian.html#gad957409ab5af42ef4fb567ca386880a0" title="Initializes the Virginian database.">virg_init()</a>. This must be called after you are finished using the database to prevent memory leaks. If a database file is still open when this is called, then <a class="el" href="group__database.html#ga8e2d3e3bf58554a5c2b58372c2211b66" title="Close the currently opened database.">virg_db_close()</a> is also called.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="close_8c_source.html#l00015">15</a> of file <a class="el" href="close_8c_source.html">close.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">int</span> i;
        cudaError_t r;

        <a class="code" href="group__database.html#ga8e2d3e3bf58554a5c2b58372c2211b66" title="Close the currently opened database.">virg_db_close</a>(v);

        <span class="comment">// free each tablet slot, use cuda free depending on if its pinned</span>
        <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="virginian_8h.html#a9c6e6ed866369d7cc0288fafd223a87b" title="tablet slots to allocate in memory">VIRG_MEM_TABLETS</a>; i++) {
<span class="preprocessor">#ifndef VIRG_NOPINNED</span>
<span class="preprocessor"></span>                r = cudaFreeHost(v-&gt;<a class="code" href="structvirginian.html#a5b2712b05652c6c884e7550c15a86428" title="pointer to each main-memory tablet slot">tablet_slots</a>[i]);
                <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(r != cudaSuccess, <span class="stringliteral">&quot;Problem freeing slot&quot;</span>)
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>                free(v-&gt;<a class="code" href="structvirginian.html#a5b2712b05652c6c884e7550c15a86428" title="pointer to each main-memory tablet slot">tablet_slots</a>[i]);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        }

        <span class="comment">// free gpu slots</span>
        r = cudaFree(v-&gt;<a class="code" href="structvirginian.html#a8cf3b95984dce9135f5937237bdabdb8" title="pointer to the beginning of the allocated gpu tablet slots">gpu_slots</a>);
        <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(r != cudaSuccess, <span class="stringliteral">&quot;Problem freeing slot&quot;</span>)

        <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(pthread_mutex_destroy(&amp;v-&gt;slot_lock), &quot;Could not destroy mutex&quot;)

        return <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="gad957409ab5af42ef4fb567ca386880a0"></a><!-- doxytag: member="init.c::virg_init" ref="gad957409ab5af42ef4fb567ca386880a0" args="(virginian *v)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializes the Virginian database. </p>
<p>Initializes or re-initializes the struct that holds the state of the database. It sets a number of options via defaults hard-coded or defined in <a class="el" href="virginian_8h.html">virginian.h</a>. Additionally, this function is responsible for allocating the tablet memory areas in both main memory and GPU memory. If the VIRG_DEBUG macro is defined, both the state struct and the tablet memory areas are set to 0xDEADBEEF. Finally, this function also initializes the CUDA context. The allocations made in this function are freed with <a class="el" href="group__virginian.html#ga0a9d19e23195be294f562b4ab50dc36e" title="Closes the Virginian database by freeing allocations.">virg_close()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00019">19</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">int</span> i;

        cudaError_t r;

<span class="preprocessor">#ifdef VIRG_DEBUG</span>
<span class="preprocessor"></span>        <span class="comment">// zero out db struct for valgrind</span>
        memset(&amp;v-&gt;<a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>, 0xDEADBEEF, <span class="keyword">sizeof</span>(<a class="code" href="structvirg__db.html" title="State of the currently open database.">virg_db</a>));
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
        <span class="comment">// set struct defaults</span>
        v-&gt;<a class="code" href="structvirginian.html#a5decd7c40e471d59f7d423669495f13a" title="round-robin counter to kick out tablets">tablet_slot_counter</a> = 0;
        v-&gt;<a class="code" href="structvirginian.html#ab4ab09cb712e32031e114b442c0c8157" title="number of tablet slots which are unused">tablet_slots_taken</a> = 0;
        v-&gt;<a class="code" href="structvirginian.html#a2820593ec616cb2093cabb74e7affa5e" title="threads per block for gpu execution">threads_per_block</a> = <a class="code" href="virginian_8h.html#a924b9ad484637fcf22848b33d0e41663" title="cuda threads per block">VIRG_THREADSPERBLOCK</a>;
        v-&gt;<a class="code" href="structvirginian.html#aa09161b8fdfc2f003a751bde3268677d" title="number of threads to use for multi-core cpu execution">multi_threads</a> = <a class="code" href="virginian_8h.html#af3c316d0cee6f29151469cd5ba1c1cfb" title="number of threads to use for the multicore cpu virtual machine">VIRG_MULTITHREADS</a>;
        v-&gt;<a class="code" href="structvirginian.html#add73a147022b2ac21e84dcf50781a7f0" title="enables multicore">use_multi</a> = 0;
        v-&gt;<a class="code" href="structvirginian.html#ae93e73cfddaddff800b4d6e11204c8a7" title="enables gpu execution">use_gpu</a> = 0;
        v-&gt;<a class="code" href="structvirginian.html#af361324ce5a460bc8e54b6ccde5c5c47" title="enables stream execution">use_stream</a> = 0;
        v-&gt;<a class="code" href="structvirginian.html#aa3e6f75167f32ecdadd72f330f4b5a31" title="enables mapped execution, only used if stream is false">use_mmap</a> = 0;
        v-&gt;<a class="code" href="structvirginian.html#a736058b8d4409694d3d6013b4d92bcee" title="file descriptor for the open database">dbfd</a> = -1;

        <span class="comment">// init mutex for locking tablet slots</span>
        <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(pthread_mutex_init(&amp;v-&gt;<a class="code" href="structvirginian.html#a26ed4b0163e1b8a4ac20898715519588" title="mutex for multi-core manipulation of the tablet slots">slot_lock</a>, NULL), <span class="stringliteral">&quot;Could not init mutex&quot;</span>)

        <span class="comment">// set proper flags, first one enables mapped memory</span>
        cudaSetDeviceFlags(cudaDeviceMapHost | cudaDeviceScheduleSpin | cudaDeviceScheduleBlockingSync);
        <a class="code" href="virginian_8h.html#a1d1644a2595d5c074a86067bfa7ddd4a" title="return failure and print it if there is an outstanding cuda error">VIRG_CUDCHK</a>(&quot;set device flags&quot;);

        <span class="comment">// initialize cuda context</span>
        cudaSetDevice(<a class="code" href="virginian_8h.html#abd6906455b1de7b6b275ef7d6dd3f449" title="cuda device selected">VIRG_CUDADEVICE</a>);
        <a class="code" href="virginian_8h.html#a1d1644a2595d5c074a86067bfa7ddd4a" title="return failure and print it if there is an outstanding cuda error">VIRG_CUDCHK</a>(&quot;set device&quot;);

        <span class="comment">// initialize tablets</span>
        for(i = 0; i &lt; <a class="code" href="virginian_8h.html#a9c6e6ed866369d7cc0288fafd223a87b" title="tablet slots to allocate in memory">VIRG_MEM_TABLETS</a>; i++) {
                v-&gt;<a class="code" href="structvirginian.html#ae6776e19e678dca8d07646de4ad8ae8c" title="use status of the tablet slot, 0 for unused, 1 for used, &gt;1 for each lock">tablet_slot_status</a>[i] = 0;

                <span class="comment">// if pinned, then use cuda alloc</span>
<span class="preprocessor">#ifndef VIRG_NOPINNED</span>
<span class="preprocessor"></span>                r = cudaHostAlloc((<span class="keywordtype">void</span>**)&amp;v-&gt;<a class="code" href="structvirginian.html#a5b2712b05652c6c884e7550c15a86428" title="pointer to each main-memory tablet slot">tablet_slots</a>[i], <a class="code" href="virginian_8h.html#a2ac1573feba851890134cec421e2e763" title="size of tablets, must be equal for the db file and the database">VIRG_TABLET_SIZE</a>, cudaHostAllocMapped);
                <a class="code" href="virginian_8h.html#a1d1644a2595d5c074a86067bfa7ddd4a" title="return failure and print it if there is an outstanding cuda error">VIRG_CUDCHK</a>(<span class="stringliteral">&quot;Allocating pinned tablet memory&quot;</span>);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>                v-&gt;<a class="code" href="structvirginian.html#a5b2712b05652c6c884e7550c15a86428" title="pointer to each main-memory tablet slot">tablet_slots</a>[i] = malloc(<a class="code" href="virginian_8h.html#a2ac1573feba851890134cec421e2e763" title="size of tablets, must be equal for the db file and the database">VIRG_TABLET_SIZE</a>);
                <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(v-&gt;<a class="code" href="structvirginian.html#a5b2712b05652c6c884e7550c15a86428" title="pointer to each main-memory tablet slot">tablet_slots</a>[i] == NULL, <span class="stringliteral">&quot;Problem allocating tablet memory&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef VIRG_DEBUG</span>
<span class="preprocessor"></span>                <span class="comment">// this should only be read when status is nonzero</span>
                v-&gt;<a class="code" href="structvirginian.html#acf3ed38504bbb207ffa500d1508cad97" title="id of the tablet in each slot, valid only if status is above 0">tablet_slot_ids</a>[i] = 0;

                <span class="comment">// zero out memory for debugging</span>
                memset(v-&gt;<a class="code" href="structvirginian.html#a5b2712b05652c6c884e7550c15a86428" title="pointer to each main-memory tablet slot">tablet_slots</a>[i], 0xDEADBEEF, <a class="code" href="virginian_8h.html#a2ac1573feba851890134cec421e2e763" title="size of tablets, must be equal for the db file and the database">VIRG_TABLET_SIZE</a>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        }

        <span class="keywordflow">if</span>(<a class="code" href="virginian_8h.html#a55a19fc1029cc2d13cddfa8e0b9077b1" title="tablet slots to allocate in gpu memory">VIRG_GPU_TABLETS</a> &gt; 0) {
                <span class="comment">// initialize gpu tablets as a single block</span>
                r = cudaMalloc((<span class="keywordtype">void</span>**)&amp;v-&gt;<a class="code" href="structvirginian.html#a8cf3b95984dce9135f5937237bdabdb8" title="pointer to the beginning of the allocated gpu tablet slots">gpu_slots</a>, <a class="code" href="virginian_8h.html#a2ac1573feba851890134cec421e2e763" title="size of tablets, must be equal for the db file and the database">VIRG_TABLET_SIZE</a> * <a class="code" href="virginian_8h.html#a55a19fc1029cc2d13cddfa8e0b9077b1" title="tablet slots to allocate in gpu memory">VIRG_GPU_TABLETS</a>);
                <a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d" title="print an error and return failure if the condition is true">VIRG_CHECK</a>(r != cudaSuccess, <span class="stringliteral">&quot;Problem allocating GPU tablet memory&quot;</span>);
<span class="preprocessor">#ifdef VIRG_DEBUG</span>
<span class="preprocessor"></span>                cudaMemset(v-&gt;<a class="code" href="structvirginian.html#a8cf3b95984dce9135f5937237bdabdb8" title="pointer to the beginning of the allocated gpu tablet slots">gpu_slots</a>, 0xDEADBEEF, <a class="code" href="virginian_8h.html#a2ac1573feba851890134cec421e2e763" title="size of tablets, must be equal for the db file and the database">VIRG_TABLET_SIZE</a> * <a class="code" href="virginian_8h.html#a55a19fc1029cc2d13cddfa8e0b9077b1" title="tablet slots to allocate in gpu memory">VIRG_GPU_TABLETS</a>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        }

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="gaebf521b283ccb4f30d25c69bcdb5cf7c"></a><!-- doxytag: member="query.c::virg_query" ref="gaebf521b283ccb4f30d25c69bcdb5cf7c" args="(virginian *v, virg_reader **reader, const char *query)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_query </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvirg__reader.html">virg_reader</a> **&#160;</td>
          <td class="paramname"><em>reader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>query</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Executes a SQL query. </p>
<p>This function is the primary driver of SQL queries. Though it is simple and its actions can be called directly, this interface should be sufficient for most purposes. The reader pointer should not point to an allocated block, as it will be reassigned. See the <a class="el" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a> documentation for more information on accessing results. Once results are no longer needed, <a class="el" href="group__virginian.html#ga4016938c51ab476124eb67d93dc2f994" title="Cleans up after a SQL query.">virg_release()</a> should be called to clean up after the query, otherwise you will probably leak memory.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">reader</td><td>Pointer to a pointer to a reader of results </td></tr>
    <tr><td class="paramname">query</td><td>SQL query string </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="query_8c_source.html#l00021">21</a> of file <a class="el" href="query_8c_source.html">query.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *<a class="code" href="vm__gpu_8cu.html#a946d0d35b3bc20faef9b521a79e7e89a" title="GPU constant memory variable to hold the virtual machine execution context.">vm</a> = <a class="code" href="group__vm.html#ga81b5ae6a1970758a5f3b62f3cabe5e95" title="Initialize a virtual machine context.">virg_vm_init</a>();
        <a class="code" href="group__virginian.html#gafd19659c526da8b2d82fd4ca0167a28f" title="Parses a SQL query.">virg_sql</a>(v, query, vm);

        <a class="code" href="group__vm.html#ga7112813a421bcf264ceae71555f18dce" title="Execute the virtual machine using its stored statement.">virg_vm_execute</a>(v, vm);
        reader[0] = (<a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a>*)malloc(<span class="keyword">sizeof</span>(<a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a>));
        <a class="code" href="group__reader.html#ga8703db2abff6a068f0e032813b42a2bc" title="Initialize a result tablet reader.">virg_reader_init</a>(v, reader[0], vm);

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga4016938c51ab476124eb67d93dc2f994"></a><!-- doxytag: member="release.c::virg_release" ref="ga4016938c51ab476124eb67d93dc2f994" args="(virginian *v, virg_reader *reader)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void virg_release </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvirg__reader.html">virg_reader</a> *&#160;</td>
          <td class="paramname"><em>reader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Cleans up after a SQL query. </p>
<p>Call this after you are done with the results of a SQL query to unlock and purge the result tablets and release the reader. See the documentation of <a class="el" href="group__virginian.html#gaebf521b283ccb4f30d25c69bcdb5cf7c" title="Executes a SQL query.">virg_query()</a> for an example.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">reader</td><td>Pointer to a pointer to a reader of results </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="release_8c_source.html#l00014">14</a> of file <a class="el" href="release_8c_source.html">release.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="group__reader.html#ga6451f1b2ed82890835304dfa28b58dd7" title="Frees the resources used by the reader.">virg_reader_free</a>(v, reader);
        <a class="code" href="group__vm.html#ga62ed45a3768fa86f06a144ddc52852aa" title="Cleanup a virtual machine.">virg_vm_cleanup</a>(v, reader-&gt;<a class="code" href="structvirg__reader.html#ae8db84ecef576b4d02a698d1f0229b4a" title="virtual machine context from which the results are taken">vm</a>);
        free(reader);
}
</pre></div>
</div>
</div>
<a class="anchor" id="gafd19659c526da8b2d82fd4ca0167a28f"></a><!-- doxytag: member="sql.tab.c::virg_sql" ref="gafd19659c526da8b2d82fd4ca0167a28f" args="(virginian *v, const char *querystr, virg_vm *vm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int virg_sql </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvirginian.html">virginian</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>querystr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvirg__vm.html">virg_vm</a> *&#160;</td>
          <td class="paramname"><em>vm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Parses a SQL query. </p>
<p>This function parses a SQL query passed as a string, runs a code generator to produce the approprate opcodes, and return a virtual machine ready to execute the query. This function hides all the complexity of the lexer, parser, and code generator.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the state struct of the database system </td></tr>
    <tr><td class="paramname">querystr</td><td>SQL query </td></tr>
    <tr><td class="paramname">vm</td><td>Allocated virtual machine which will be prepared to execute the passed query </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>VIRG_SUCCESS or VIRG_FAIL depending on errors during the function call </dd></dl>

<p>Definition at line <a class="el" href="sql_8tab_8c_source.html#l01929">1929</a> of file <a class="el" href="sql_8tab_8c_source.html">sql.tab.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="node_8h.html#af0669702def616c7b54949c6335afe1a" title="virginian object visible to the parser">parse_virg</a> = v;

        <a class="code" href="sql_8tab_8c.html#ac57bd4c4cef39bd360bd180f031bc74c" title="defined when Bison is run on this file">yy_scan_string</a>(querystr);
        yyparse();
        <a class="code" href="sql_8tab_8c.html#a5eb60e0dcfe23734540785a49f118dfe" title="defined when Bison is run on this file">yylex_destroy</a>();

        <a class="code" href="generate_8c.html#a2a8a0e487b18c48216cf4f0944bd2d6e" title="Generate opcodes from parsed sql tree.">virg_sql_generate</a>(<a class="code" href="sql_8tab_8c.html#a2e12c1561fbd5ff857898643ff9334f3" title="root node of AST">query_root</a>, vm);
        node_root_free(<a class="code" href="sql_8tab_8c.html#a2e12c1561fbd5ff857898643ff9334f3" title="root node of AST">query_root</a>);

        <span class="keywordflow">return</span> <a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2" title="used to return a function success">VIRG_SUCCESS</a>;
}
</pre></div>
</div>
</div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Feb 15 2012 01:21:46 for Virginian by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
