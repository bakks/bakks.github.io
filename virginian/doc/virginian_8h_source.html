<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Virginian: src/virginian.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Virginian</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/virginian.h</div>  </div>
</div>
<div class="contents">
<a href="virginian_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef VIRGINIAN</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define VIRGINIAN</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">/**</span>
<a name="l00005"></a>00005 <span class="comment"> * @file</span>
<a name="l00006"></a>00006 <span class="comment"> * @author Peter Bakkum &lt;pbb7c@virginia.edu&gt;</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * @section Description</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This is the header file for the entire Virginian database. It contains nearly</span>
<a name="l00011"></a>00011 <span class="comment"> * all of the includes, macros, data structures, and function definitions for</span>
<a name="l00012"></a>00012 <span class="comment"> * the database and can be used with a static object file containing the</span>
<a name="l00013"></a>00013 <span class="comment"> * database&#39;s entire functionality.</span>
<a name="l00014"></a>00014 <span class="comment"> */</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">/**</span>
<a name="l00017"></a>00017 <span class="comment"> * @defgroup virginian Virginian Functions</span>
<a name="l00018"></a>00018 <span class="comment"> * @defgroup database Database File functions</span>
<a name="l00019"></a>00019 <span class="comment"> * @defgroup table Table Functions</span>
<a name="l00020"></a>00020 <span class="comment"> * @defgroup tablet Tablet Functions</span>
<a name="l00021"></a>00021 <span class="comment"> * @defgroup vm Virtual Machine Functions</span>
<a name="l00022"></a>00022 <span class="comment"> * @defgroup reader Tablet Reader Functions</span>
<a name="l00023"></a>00023 <span class="comment"> */</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#ifdef _XOPEN_SOURCE</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#undef _XOPEN_SOURCE</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="comment">/// enables 64bit file operations</span>
<a name="l00029"></a><a class="code" href="virginian_8h.html#a78c99ffd76a7bb3c8c74db76207e9ab4">00029</a> <span class="comment"></span><span class="preprocessor">#define _XOPEN_SOURCE 500</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;pthread.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;cuda.h&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;cuda_runtime_api.h&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;driver_types.h&gt;</span>
<a name="l00046"></a>00046 <span class="comment"></span>
<a name="l00047"></a>00047 <span class="comment">/// shortcut for 2^10</span>
<a name="l00048"></a><a class="code" href="virginian_8h.html#adfba1fb4e5416737ea8b676096295495">00048</a> <span class="comment"></span><span class="preprocessor">#define VIRG_KB                 1024</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="comment">/// shortcut for 2^20</span>
<a name="l00050"></a><a class="code" href="virginian_8h.html#a364e84fc0e99dc76063ed0be547b2a3e">00050</a> <span class="comment"></span><span class="preprocessor">#define VIRG_MB                 1048576</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="comment">/// shortcut for 2^30</span>
<a name="l00052"></a><a class="code" href="virginian_8h.html#adb500cb099e5d31878d704586d7362ed">00052</a> <span class="comment"></span><span class="preprocessor">#define VIRG_GB                 1073741824</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00054"></a>00054 <span class="comment">/// acceptable error in floating point comparisons</span>
<a name="l00055"></a><a class="code" href="virginian_8h.html#af09309bb5d4ece011dd90dd3f5f2ceac">00055</a> <span class="comment"></span><span class="preprocessor">#define VIRG_FLOAT_ERROR                0.0001</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00057"></a>00057 <span class="comment">/// size of tablets, must be equal for the db file and the database</span>
<a name="l00058"></a><a class="code" href="virginian_8h.html#a2ac1573feba851890134cec421e2e763">00058</a> <span class="comment"></span><span class="preprocessor">#define VIRG_TABLET_SIZE                (8 * VIRG_MB)</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="comment">/// rows to allocate when a tablet is created</span>
<a name="l00060"></a><a class="code" href="virginian_8h.html#a9f440281a17ca1c0adab888f861278b6">00060</a> <span class="comment"></span><span class="preprocessor">#define VIRG_TABLET_INITIAL_KEYS        256</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="comment">/// rows to add when a tablet is full and rows still need to be added </span>
<a name="l00062"></a><a class="code" href="virginian_8h.html#a83afecb586f9f21f3f2d4d8d961b0535">00062</a> <span class="comment"></span><span class="preprocessor">#define VIRG_TABLET_KEY_INCREMENT       (2048 * 128)</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="comment">/// initial size of the fixed block</span>
<a name="l00064"></a><a class="code" href="virginian_8h.html#ac66ec69a5db41b1db69335bea31cc639">00064</a> <span class="comment"></span><span class="preprocessor">#define VIRG_TABLET_INITIAL_FIXED       0</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="comment">/// initial size of the variable block</span>
<a name="l00066"></a><a class="code" href="virginian_8h.html#ad68fe01cd6f7a13b22e9e1741abcca81">00066</a> <span class="comment"></span><span class="preprocessor">#define VIRG_TABLET_INITIAL_VARIABLE    0</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="comment">/// size reserved for the variable block when the fixed is maxed out</span>
<a name="l00068"></a><a class="code" href="virginian_8h.html#a634ca639104eef31bd6787366466a2d1">00068</a> <span class="comment"></span><span class="preprocessor">#define VIRG_TABLET_MAXED_VARIABLE      (VIRG_TABLET_SIZE / 16)</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="comment">/// initial area reserved for the variable size block of result tablets</span>
<a name="l00070"></a><a class="code" href="virginian_8h.html#ac80a5193a63bb39ea409567e18cffd57">00070</a> <span class="comment"></span><span class="preprocessor">#define VIRG_RESULT_INITIAL_VARIABLE    (512 * VIRG_KB)</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="comment">/// initial disk slot meta informations to allocate for tablets</span>
<a name="l00072"></a><a class="code" href="virginian_8h.html#a322fb6fe4d60ffeb3e91ca70114d1654">00072</a> <span class="comment"></span><span class="preprocessor">#define VIRG_TABLET_INFO_SIZE           16</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="comment">/// meta information structs to add when all are used up and we need another</span>
<a name="l00074"></a><a class="code" href="virginian_8h.html#a002840681a46089ae65d9b4cf6a2eb50">00074</a> <span class="comment"></span><span class="preprocessor">#define VIRG_TABLET_INFO_INCREMENT      32</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00076"></a>00076 <span class="comment">/// maximum table columns supported</span>
<a name="l00077"></a><a class="code" href="virginian_8h.html#a9c9a2a8531dbc0da7a03ccd1a8cd00f7">00077</a> <span class="comment"></span><span class="preprocessor">#define VIRG_MAX_COLUMNS                16</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="comment">/// maximum tables supported</span>
<a name="l00079"></a><a class="code" href="virginian_8h.html#a6b400ca21647bb81159b1c459ef053e2">00079</a> <span class="comment"></span><span class="preprocessor">#define VIRG_MAX_TABLES                 16</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span><span class="comment">/// maximum column name length supported</span>
<a name="l00081"></a><a class="code" href="virginian_8h.html#a2cccd75830388d7a23d0dc8dca454f57">00081</a> <span class="comment"></span><span class="preprocessor">#define VIRG_MAX_COLUMN_NAME    16</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span><span class="comment">/// maximum table name length supported</span>
<a name="l00083"></a><a class="code" href="virginian_8h.html#a3dc8d40b3fe67f3576cf3e6336efdcdf">00083</a> <span class="comment"></span><span class="preprocessor">#define VIRG_MAX_TABLE_NAME             32</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00085"></a>00085 <span class="comment">/// tablet slots to allocate in memory</span>
<a name="l00086"></a><a class="code" href="virginian_8h.html#a9c6e6ed866369d7cc0288fafd223a87b">00086</a> <span class="comment"></span><span class="preprocessor">#define VIRG_MEM_TABLETS                64</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="comment">/// tablet slots to allocate in gpu memory</span>
<a name="l00088"></a><a class="code" href="virginian_8h.html#a55a19fc1029cc2d13cddfa8e0b9077b1">00088</a> <span class="comment"></span><span class="preprocessor">#define VIRG_GPU_TABLETS                2</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span><span class="comment">/// maximum number of tables to read from supported in vm</span>
<a name="l00090"></a><a class="code" href="virginian_8h.html#ae435eb27cbf4eb64670ab0b8bf44db98">00090</a> <span class="comment"></span><span class="preprocessor">#define VIRG_VM_TABLES                  1</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span><span class="comment">/// number of rows to process on the cpu in a block</span>
<a name="l00092"></a><a class="code" href="virginian_8h.html#a6b039207848380e774147e035d3876c0">00092</a> <span class="comment"></span><span class="preprocessor">#define VIRG_CPU_SIMD                   64</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span><span class="comment">/// buffer size to store a single row in virg_reader</span>
<a name="l00094"></a><a class="code" href="virginian_8h.html#a3bb0ed9071587928925932e169a02985">00094</a> <span class="comment"></span><span class="preprocessor">#define VIRG_ROW_BUFFER                 256</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="comment">/// number of vm registers allocated</span>
<a name="l00096"></a><a class="code" href="virginian_8h.html#a97265ed63626e0bd7a2bb4b7ad8fb661">00096</a> <span class="comment"></span><span class="preprocessor">#define VIRG_REGS                       16</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span><span class="comment">/// number of vm global registers allocated</span>
<a name="l00098"></a><a class="code" href="virginian_8h.html#ac2542ec287188e6b9d82904c65e0191c">00098</a> <span class="comment"></span><span class="preprocessor">#define VIRG_GLOBAL_REGS                16</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span><span class="comment">/// maximum number of query statement opcodes allowed</span>
<a name="l00100"></a><a class="code" href="virginian_8h.html#a35812eb8ca48e1d30a7c7dd3b4797af4">00100</a> <span class="comment"></span><span class="preprocessor">#define VIRG_OPS                        32</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00102"></a>00102 <span class="comment">/// cuda device selected</span>
<a name="l00103"></a><a class="code" href="virginian_8h.html#abd6906455b1de7b6b275ef7d6dd3f449">00103</a> <span class="comment"></span><span class="preprocessor">#define VIRG_CUDADEVICE                         0</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span><span class="comment">/// cuda threads per block</span>
<a name="l00105"></a><a class="code" href="virginian_8h.html#a924b9ad484637fcf22848b33d0e41663">00105</a> <span class="comment"></span><span class="preprocessor">#define VIRG_THREADSPERBLOCK            128</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00107"></a>00107 <span class="comment">/**</span>
<a name="l00108"></a>00108 <span class="comment"> * mask used for math operations dependent on the size of threads per block</span>
<a name="l00109"></a>00109 <span class="comment"> * with two&#39;s complement integers this should be the negative of the threads</span>
<a name="l00110"></a>00110 <span class="comment"> * per block variable above but I get casting warning when I don&#39;t use hex</span>
<a name="l00111"></a>00111 <span class="comment"> * that can probably be fixed</span>
<a name="l00112"></a>00112 <span class="comment"> */</span>
<a name="l00113"></a><a class="code" href="virginian_8h.html#a676649bccad95bc8c5443fa8f25ffc28">00113</a> <span class="preprocessor">#define VIRG_THREADSPERBLOCK_MASK       0xFFFFFF80</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span><span class="comment">/// number of threads to use for the multicore cpu virtual machine</span>
<a name="l00115"></a><a class="code" href="virginian_8h.html#af3c316d0cee6f29151469cd5ba1c1cfb">00115</a> <span class="comment"></span><span class="preprocessor">#define VIRG_MULTITHREADS               8</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00117"></a>00117 <span class="comment">/// used to return a function failure</span>
<a name="l00118"></a><a class="code" href="virginian_8h.html#ac21dbbc06d2c74731554f359edd10702">00118</a> <span class="comment"></span><span class="preprocessor">#define VIRG_FAIL               0</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span><span class="comment">/// used to return a function success</span>
<a name="l00120"></a><a class="code" href="virginian_8h.html#ae39e133b80ee1958313531a94cb517d2">00120</a> <span class="comment"></span><span class="preprocessor">#define VIRG_SUCCESS            1</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00122"></a>00122 <span class="comment">/// convenience macro to return the min of the two inputs</span>
<a name="l00123"></a><a class="code" href="virginian_8h.html#ac8c9f6fbeb9d60a07ec61b3f3430d48a">00123</a> <span class="comment"></span><span class="preprocessor">#define VIRG_MIN(a, b)          (a &lt; b ? a : b)</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span><span class="comment">/// convenience macro to return the max of the two inputs</span>
<a name="l00125"></a><a class="code" href="virginian_8h.html#aafa5e03a9cb5ee38048a809d1bef954e">00125</a> <span class="comment"></span><span class="preprocessor">#define VIRG_MAX(a, b)          (a &lt; b ? b : a)</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span><span class="comment">/// convenience macro to verify a number is a power of 2</span>
<a name="l00127"></a><a class="code" href="virginian_8h.html#ac342aca583356315f755c78ac9d0ccc6">00127</a> <span class="comment"></span><span class="preprocessor">#define VIRG_ISPWR2(x)          ((x != 0) &amp;&amp; ((x &amp; (~x + 1)) == x))</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00129"></a>00129 <span class="comment">/// print out an error with the file and line</span>
<a name="l00130"></a><a class="code" href="virginian_8h.html#a5f5d71a751fedca1701bb61f19665cb9">00130</a> <span class="comment"></span><span class="preprocessor">#define VIRG_ERROR(x)           fprintf(stderr, &quot;::: Virginian error %s line %d:: &quot; x &quot;\n&quot;, __FILE__, __LINE__);</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00132"></a>00132 <span class="comment">/// print an error and return failure if the condition is true</span>
<a name="l00133"></a><a class="code" href="virginian_8h.html#a5199c848f6c06c5aabdc6546774d4f0d">00133</a> <span class="comment"></span><span class="preprocessor">#define VIRG_CHECK(cond, args)                                                                                             \</span>
<a name="l00134"></a>00134 <span class="preprocessor">        if(cond) {                                                                                                                                 \</span>
<a name="l00135"></a>00135 <span class="preprocessor">                VIRG_ERROR(args)                                                                                                           \</span>
<a name="l00136"></a>00136 <span class="preprocessor">                return VIRG_FAIL;                                                                                                          \</span>
<a name="l00137"></a>00137 <span class="preprocessor">        }</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00139"></a>00139 <span class="comment">/// return failure and print it if there is an outstanding cuda error</span>
<a name="l00140"></a><a class="code" href="virginian_8h.html#a1d1644a2595d5c074a86067bfa7ddd4a">00140</a> <span class="comment"></span><span class="preprocessor">#define VIRG_CUDCHK(desc) VIRG_CUDCHKCALL(cudaGetLastError(), desc)</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00142"></a>00142 <span class="comment">/// return failure and print it if there in a cuda error returned from a call</span>
<a name="l00143"></a><a class="code" href="virginian_8h.html#a78a2443f3caf7376459ae7a8b4bd25ea">00143</a> <span class="comment"></span><span class="preprocessor">#define VIRG_CUDCHKCALL(call, desc)                                                                                        \</span>
<a name="l00144"></a>00144 <span class="preprocessor">        { cudaError_t r;                                                                                                                   \</span>
<a name="l00145"></a>00145 <span class="preprocessor">        if((r = call) != cudaSuccess) {                                                                                    \</span>
<a name="l00146"></a>00146 <span class="preprocessor">                fprintf(stderr, &quot;CUDA %s error: %s :: %s line %d\n&quot;,                               \</span>
<a name="l00147"></a>00147 <span class="preprocessor">                        desc, cudaGetErrorString(r), __FILE__, __LINE__);                                  \</span>
<a name="l00148"></a>00148 <span class="preprocessor">                return VIRG_FAIL;                                                                                                          \</span>
<a name="l00149"></a>00149 <span class="preprocessor">        }}</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span>
<a name="l00151"></a>00151 <span class="comment"></span>
<a name="l00152"></a>00152 <span class="comment">/** VIRG_DEBUG_CHECK calls are like VIRG_CHECK calls but only get compiled in if</span>
<a name="l00153"></a>00153 <span class="comment"> * the VIRG_DEBUG macro is defined</span>
<a name="l00154"></a>00154 <span class="comment"> */</span>
<a name="l00155"></a>00155 <span class="preprocessor">#ifdef VIRG_DEBUG</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span><span class="preprocessor">        #define VIRG_DEBUG_CHECK(cond, args) VIRG_CHECK(cond, args)</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00158"></a><a class="code" href="virginian_8h.html#a53c3d8f6ba6373cf9095d58d3ba4f7e1">00158</a> <span class="preprocessor"></span><span class="preprocessor">        #define VIRG_DEBUG_CHECK(cond, args);</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00160"></a>00160 <span class="preprocessor"></span>
<a name="l00161"></a>00161 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
<a name="l00163"></a>00163 <span class="preprocessor">#endif</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00165"></a>00165 <span class="comment">/// enumeration and integer assignments of all virtual machine opcodes</span>
<a name="l00166"></a><a class="code" href="virginian_8h.html#a93dd5be89047ac0f1676726df94af3be">00166</a> <span class="comment"></span><span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00167"></a>00167         OP_Table                = 0,
<a name="l00168"></a>00168         OP_ResultColumn = 1,
<a name="l00169"></a>00169         OP_Parallel             = 2,
<a name="l00170"></a>00170         OP_Finish               = 3,
<a name="l00171"></a>00171         OP_Column               = 4,
<a name="l00172"></a>00172         OP_Rowid                = 5,
<a name="l00173"></a>00173         OP_Result               = 6,
<a name="l00174"></a>00174         OP_Converge             = 7,
<a name="l00175"></a>00175         OP_Invalid              = 8,
<a name="l00176"></a>00176         OP_Cast                 = 9,
<a name="l00177"></a>00177         OP_Integer              = 10,
<a name="l00178"></a>00178         OP_Float                = 11,
<a name="l00179"></a>00179         OP_Le                   = 12,
<a name="l00180"></a>00180         OP_Lt                   = 13,
<a name="l00181"></a>00181         OP_Ge                   = 14,
<a name="l00182"></a>00182         OP_Gt                   = 15,
<a name="l00183"></a>00183         OP_Eq                   = 16,
<a name="l00184"></a>00184         OP_Neq                  = 17,
<a name="l00185"></a>00185         OP_Add                  = 18,
<a name="l00186"></a>00186         OP_Sub                  = 19,
<a name="l00187"></a>00187         OP_Mul                  = 20,
<a name="l00188"></a>00188         OP_Div                  = 21,
<a name="l00189"></a>00189         OP_And                  = 22,
<a name="l00190"></a>00190         OP_Or                   = 23,
<a name="l00191"></a>00191         OP_Not                  = 24,
<a name="l00192"></a>00192         OP_Nop                  = 25
<a name="l00193"></a>00193 } <a class="code" href="virginian_8h.html#a93dd5be89047ac0f1676726df94af3be" title="enumeration and integer assignments of all virtual machine opcodes">virg_ops</a>;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="comment"></span>
<a name="l00196"></a>00196 <span class="comment">/// enumeration of all variable types used by the database</span>
<a name="l00197"></a><a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b">00197</a> <span class="comment"></span><span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00198"></a>00198         VIRG_INT        = 0,
<a name="l00199"></a>00199         VIRG_INT64      = 1,
<a name="l00200"></a>00200         VIRG_FLOAT      = 2,
<a name="l00201"></a>00201         VIRG_DOUBLE     = 3,
<a name="l00202"></a>00202         VIRG_CHAR       = 4,
<a name="l00203"></a>00203         VIRG_STRING     = 5,
<a name="l00204"></a>00204         VIRG_NULL       = 6
<a name="l00205"></a>00205 } <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a>;
<a name="l00206"></a>00206 <span class="comment"></span>
<a name="l00207"></a>00207 <span class="comment">/// used when operating on two types to get the more general type</span>
<a name="l00208"></a>00208 <span class="comment"></span><a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a> virg_generalizetype(<a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a> t1, <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a> t2);
<a name="l00209"></a>00209 <span class="comment"></span>
<a name="l00210"></a>00210 <span class="comment">/// size in bytes of variables types, indexed by their enumeration values</span>
<a name="l00211"></a>00211 <span class="comment"></span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> virg_sizes[7] = {
<a name="l00212"></a>00212         <span class="keyword">sizeof</span>(int),                    <span class="comment">// 0</span>
<a name="l00213"></a>00213         <span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>),  <span class="comment">// 1</span>
<a name="l00214"></a>00214         <span class="keyword">sizeof</span>(float),                  <span class="comment">// 2</span>
<a name="l00215"></a>00215         <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),                 <span class="comment">// 3</span>
<a name="l00216"></a>00216         <span class="keyword">sizeof</span>(char),                   <span class="comment">// 4</span>
<a name="l00217"></a>00217         (<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * 4),             <span class="comment">// 5</span>
<a name="l00218"></a>00218         0                                               <span class="comment">// 6</span>
<a name="l00219"></a>00219 };
<a name="l00220"></a>00220 <span class="comment"></span>
<a name="l00221"></a>00221 <span class="comment">/**</span>
<a name="l00222"></a>00222 <span class="comment"> * @brief Information associated with a tablet on disk</span>
<a name="l00223"></a>00223 <span class="comment"> *</span>
<a name="l00224"></a>00224 <span class="comment"> * This struct is used in a dynamically allocated array to store the locations</span>
<a name="l00225"></a>00225 <span class="comment"> * of tablets on disk. To find a tablet on disk, these will be iterated over.</span>
<a name="l00226"></a>00226 <span class="comment"> * Note that though a tablet is in disk it may also be in memory, possibly with</span>
<a name="l00227"></a>00227 <span class="comment"> * changes that have not been flushed to disk</span>
<a name="l00228"></a>00228 <span class="comment"> */</span>
<a name="l00229"></a><a class="code" href="structvirg__tablet__info.html">00229</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{<span class="comment"></span>
<a name="l00230"></a>00230 <span class="comment">        /// id of the tablet stored in this slot, valid only if used == 1</span>
<a name="l00231"></a><a class="code" href="structvirg__tablet__info.html#ac3d14971c28b9823b686ab0b848002b2">00231</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>        <a class="code" href="structvirg__tablet__info.html#ac3d14971c28b9823b686ab0b848002b2" title="id of the tablet stored in this slot, valid only if used == 1">id</a>;<span class="comment"></span>
<a name="l00232"></a>00232 <span class="comment">        /// note whether or not there is a tablet stored in this disk slot</span>
<a name="l00233"></a><a class="code" href="structvirg__tablet__info.html#a5d254b530b1e2bf333f614c96afefe6f">00233</a> <span class="comment"></span>        <span class="keywordtype">int</span>                     <a class="code" href="structvirg__tablet__info.html#a5d254b530b1e2bf333f614c96afefe6f" title="note whether or not there is a tablet stored in this disk slot">used</a>;<span class="comment"></span>
<a name="l00234"></a>00234 <span class="comment">        /// the index of this struct in the array of tablet infos</span>
<a name="l00235"></a><a class="code" href="structvirg__tablet__info.html#aea94d27175afab1fdcad4d186e5e75eb">00235</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>        <a class="code" href="structvirg__tablet__info.html#aea94d27175afab1fdcad4d186e5e75eb" title="the index of this struct in the array of tablet infos">disk_slot</a>;
<a name="l00236"></a>00236 } <a class="code" href="structvirg__tablet__info.html" title="Information associated with a tablet on disk.">virg_tablet_info</a>;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="comment"></span>
<a name="l00239"></a>00239 <span class="comment">/**</span>
<a name="l00240"></a>00240 <span class="comment"> * @brief Tablet meta information</span>
<a name="l00241"></a>00241 <span class="comment"> *</span>
<a name="l00242"></a>00242 <span class="comment"> * This stores the entire structure and all attributes of a tablet. It occupies</span>
<a name="l00243"></a>00243 <span class="comment"> * the first sizeof(virg_tablet_meta) bytes of the allocated tablet area, and is</span>
<a name="l00244"></a>00244 <span class="comment"> * used to track all associated information, including the next tablet in the</span>
<a name="l00245"></a>00245 <span class="comment"> * tablet string and whether or not this is the last tablet in the string. It</span>
<a name="l00246"></a>00246 <span class="comment"> * also has the number of columns stored and the offset beginnings of each</span>
<a name="l00247"></a>00247 <span class="comment"> * column, etc. This tablet meta struct is stored directly in constant memory</span>
<a name="l00248"></a>00248 <span class="comment"> * during GPU query execution. Note that this struct is 64-bit aligned and it</span>
<a name="l00249"></a>00249 <span class="comment"> * significantly hurts performance if this is not guaranteed.</span>
<a name="l00250"></a>00250 <span class="comment"> */</span>
<a name="l00251"></a><a class="code" href="structvirg__tablet__meta.html">00251</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{<span class="comment"></span>
<a name="l00252"></a>00252 <span class="comment">        /// number of rows stored in this tablet</span>
<a name="l00253"></a><a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a">00253</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>        <a class="code" href="structvirg__tablet__meta.html#ac68b11acc7d264e16025e3017a3c671a" title="number of rows stored in this tablet">rows</a>;<span class="comment"></span>
<a name="l00254"></a>00254 <span class="comment">        /// variable type of the key column</span>
<a name="l00255"></a><a class="code" href="structvirg__tablet__meta.html#a21626738f2e3e000d376a912558130fa">00255</a> <span class="comment"></span>        <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a>          <a class="code" href="structvirg__tablet__meta.html#a21626738f2e3e000d376a912558130fa" title="variable type of the key column">key_type</a>;<span class="comment"></span>
<a name="l00256"></a>00256 <span class="comment">        /// stride of the variable type of the key column</span>
<a name="l00257"></a><a class="code" href="structvirg__tablet__meta.html#a16e649bf6f3217270c3fe84fe4d00114">00257</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>          <a class="code" href="structvirg__tablet__meta.html#a16e649bf6f3217270c3fe84fe4d00114" title="stride of the variable type of the key column">key_stride</a>;<span class="comment"></span>
<a name="l00258"></a>00258 <span class="comment">        /// stride of the key pointer variable type</span>
<a name="l00259"></a><a class="code" href="structvirg__tablet__meta.html#aa7a96e05a26f25298bece2686c758200">00259</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>          <a class="code" href="structvirg__tablet__meta.html#aa7a96e05a26f25298bece2686c758200" title="stride of the key pointer variable type">key_pointer_stride</a>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261         <span class="comment">// TODO make this a 64-bit</span><span class="comment"></span>
<a name="l00262"></a>00262 <span class="comment">        /// tablet id</span>
<a name="l00263"></a><a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e">00263</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>        <a class="code" href="structvirg__tablet__meta.html#a8287e9d36017a86bc3657de07cfbb47e" title="tablet id">id</a>;<span class="comment"></span>
<a name="l00264"></a>00264 <span class="comment">        /// id of the next tablet in the tablet string</span>
<a name="l00265"></a><a class="code" href="structvirg__tablet__meta.html#a08bff8a2b2cbe7abbbdb0e85a530b065">00265</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>        <a class="code" href="structvirg__tablet__meta.html#a08bff8a2b2cbe7abbbdb0e85a530b065" title="id of the next tablet in the tablet string">next</a>;<span class="comment"></span>
<a name="l00266"></a>00266 <span class="comment">        /// boolean indicating whether this is the last tablet in the tablet string</span>
<a name="l00267"></a><a class="code" href="structvirg__tablet__meta.html#aba80db72f84483fc51af9e39fe5c3590">00267</a> <span class="comment"></span>        <span class="keywordtype">int</span>                     <a class="code" href="structvirg__tablet__meta.html#aba80db72f84483fc51af9e39fe5c3590" title="boolean indicating whether this is the last tablet in the tablet string">last_tablet</a>;<span class="comment"></span>
<a name="l00268"></a>00268 <span class="comment">        /// boolean indicating whether or not this tablet is part of a table</span>
<a name="l00269"></a><a class="code" href="structvirg__tablet__meta.html#a1059257e09da533e228e62e881a2c813">00269</a> <span class="comment"></span>        <span class="keywordtype">int</span>                     <a class="code" href="structvirg__tablet__meta.html#a1059257e09da533e228e62e881a2c813" title="boolean indicating whether or not this tablet is part of a table">in_table</a>;<span class="comment"></span>
<a name="l00270"></a>00270 <span class="comment">        /// id of the table that this tablet is a part of, if applicable</span>
<a name="l00271"></a><a class="code" href="structvirg__tablet__meta.html#a67c202be23e22fae83de9639b3b80110">00271</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>        <a class="code" href="structvirg__tablet__meta.html#a67c202be23e22fae83de9639b3b80110" title="id of the table that this tablet is a part of, if applicable">table_id</a>;
<a name="l00272"></a>00272 <span class="comment"></span>
<a name="l00273"></a>00273 <span class="comment">        /// relative ptr to the beginning of the key column</span>
<a name="l00274"></a><a class="code" href="structvirg__tablet__meta.html#a381166a5323a226a9cf70a527e9f7876">00274</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>          <a class="code" href="structvirg__tablet__meta.html#a381166a5323a226a9cf70a527e9f7876" title="relative ptr to the beginning of the key column">key_block</a>;<span class="comment"></span>
<a name="l00275"></a>00275 <span class="comment">        /// relative ptr to the beginning of the key pointer column</span>
<a name="l00276"></a><a class="code" href="structvirg__tablet__meta.html#a9b5a18ab0b852cdcb0608d0113ce25f1">00276</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>          <a class="code" href="structvirg__tablet__meta.html#a9b5a18ab0b852cdcb0608d0113ce25f1" title="relative ptr to the beginning of the key pointer column">key_pointers_block</a>;<span class="comment"></span>
<a name="l00277"></a>00277 <span class="comment">        /// relative ptr to the beginning of the fixed-column area</span>
<a name="l00278"></a><a class="code" href="structvirg__tablet__meta.html#a7b2629d1c97658c8b7a89dff95a1d52b">00278</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>          <a class="code" href="structvirg__tablet__meta.html#a7b2629d1c97658c8b7a89dff95a1d52b" title="relative ptr to the beginning of the fixed-column area">fixed_block</a>;<span class="comment"></span>
<a name="l00279"></a>00279 <span class="comment">        /// relative ptr to the beginning of the variable-sized data area</span>
<a name="l00280"></a><a class="code" href="structvirg__tablet__meta.html#a3ec258f17124528e236512d3b30b74be">00280</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>          <a class="code" href="structvirg__tablet__meta.html#a3ec258f17124528e236512d3b30b74be" title="relative ptr to the beginning of the variable-sized data area">variable_block</a>;<span class="comment"></span>
<a name="l00281"></a>00281 <span class="comment">        /// total size of this tablet</span>
<a name="l00282"></a><a class="code" href="structvirg__tablet__meta.html#ad65a3feff0d4d970d956214bc658a962">00282</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>          <a class="code" href="structvirg__tablet__meta.html#ad65a3feff0d4d970d956214bc658a962" title="total size of this tablet">size</a>;<span class="comment"></span>
<a name="l00283"></a>00283 <span class="comment">        /// fixed-size rows that can be in this tablet without reorganizing columns</span>
<a name="l00284"></a><a class="code" href="structvirg__tablet__meta.html#a785691ca2a53ec6a5d5c34bca74c882d">00284</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>        <a class="code" href="structvirg__tablet__meta.html#a785691ca2a53ec6a5d5c34bca74c882d" title="fixed-size rows that can be in this tablet without reorganizing columns">possible_rows</a>;<span class="comment"></span>
<a name="l00285"></a>00285 <span class="comment">        /// stride of fixed-size columns, including key and key pointer</span>
<a name="l00286"></a><a class="code" href="structvirg__tablet__meta.html#ae0d98c019521326affbcab24362a7c71">00286</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>          <a class="code" href="structvirg__tablet__meta.html#ae0d98c019521326affbcab24362a7c71" title="stride of fixed-size columns, including key and key pointer">row_stride</a>;
<a name="l00287"></a>00287 <span class="comment"></span>
<a name="l00288"></a>00288 <span class="comment">        /// number of fixed-size columns</span>
<a name="l00289"></a><a class="code" href="structvirg__tablet__meta.html#aa3595a9a97105ce081422911c30c0269">00289</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>        <a class="code" href="structvirg__tablet__meta.html#aa3595a9a97105ce081422911c30c0269" title="number of fixed-size columns">fixed_columns</a>;
<a name="l00290"></a>00290         <span class="comment">// TODO pad to 16 byte align the following two arrays</span><span class="comment"></span>
<a name="l00291"></a>00291 <span class="comment">        /// name of each of the fixed-size columns</span>
<a name="l00292"></a><a class="code" href="structvirg__tablet__meta.html#a230698c2f9081565d75603aa5fa61ba0">00292</a> <span class="comment"></span>        <span class="keywordtype">char</span>            fixed_name      [<a class="code" href="virginian_8h.html#a9c9a2a8531dbc0da7a03ccd1a8cd00f7" title="maximum table columns supported">VIRG_MAX_COLUMNS</a>][<a class="code" href="virginian_8h.html#a2cccd75830388d7a23d0dc8dca454f57" title="maximum column name length supported">VIRG_MAX_COLUMN_NAME</a>];<span class="comment"></span>
<a name="l00293"></a>00293 <span class="comment">        /// types of the fixed-size columns</span>
<a name="l00294"></a><a class="code" href="structvirg__tablet__meta.html#acc96d33e2a323f0e0b90604e3524c626">00294</a> <span class="comment"></span>        <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a>          fixed_type      [<a class="code" href="virginian_8h.html#a9c9a2a8531dbc0da7a03ccd1a8cd00f7" title="maximum table columns supported">VIRG_MAX_COLUMNS</a>];<span class="comment"></span>
<a name="l00295"></a>00295 <span class="comment">        /// size in bytes of each of the fixed-size columns</span>
<a name="l00296"></a><a class="code" href="structvirg__tablet__meta.html#af8affe76f89dd02d3f09a052982ae428">00296</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>          fixed_stride    [<a class="code" href="virginian_8h.html#a9c9a2a8531dbc0da7a03ccd1a8cd00f7" title="maximum table columns supported">VIRG_MAX_COLUMNS</a>];<span class="comment"></span>
<a name="l00297"></a>00297 <span class="comment">        /// relative pointer from fixed_block indicating the beginning of the column</span>
<a name="l00298"></a><a class="code" href="structvirg__tablet__meta.html#af46cdc848ccee989cf764abb07a9f29a">00298</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>          fixed_offset    [<a class="code" href="virginian_8h.html#a9c9a2a8531dbc0da7a03ccd1a8cd00f7" title="maximum table columns supported">VIRG_MAX_COLUMNS</a>];
<a name="l00299"></a>00299 <span class="comment"></span>
<a name="l00300"></a>00300 <span class="comment">        /// pointer to the disk info struct associated with this tablet</span>
<a name="l00301"></a><a class="code" href="structvirg__tablet__meta.html#a5bd107899dc507b45e96fd2c020aa533">00301</a> <span class="comment"></span>        <a class="code" href="structvirg__tablet__info.html" title="Information associated with a tablet on disk.">virg_tablet_info</a>        *<a class="code" href="structvirg__tablet__meta.html#a5bd107899dc507b45e96fd2c020aa533" title="pointer to the disk info struct associated with this tablet">info</a>;
<a name="l00302"></a>00302 }__attribute__((aligned(64))) <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a>;
<a name="l00303"></a>00303 <span class="comment"></span>
<a name="l00304"></a>00304 <span class="comment">/**</span>
<a name="l00305"></a>00305 <span class="comment"> * @brief Union used to store any of the possible types of virg_t in a single memory</span>
<a name="l00306"></a>00306 <span class="comment"> * location, used for the 4th argument for opcodes</span>
<a name="l00307"></a>00307 <span class="comment"> */</span>
<a name="l00308"></a><a class="code" href="unionvirg__var.html">00308</a> typedef union {
<a name="l00309"></a>00309         <span class="keywordtype">int</span>                     i;
<a name="l00310"></a>00310         <span class="keywordtype">float</span>                   f;
<a name="l00311"></a>00311         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>   li;
<a name="l00312"></a>00312         <span class="keywordtype">double</span>                  d;
<a name="l00313"></a>00313         <span class="keywordtype">char</span>                    c;
<a name="l00314"></a>00314         <span class="keywordtype">char</span>                    *s;
<a name="l00315"></a>00315 }__attribute__((aligned(8))) <a class="code" href="unionvirg__var.html" title="Union used to store any of the possible types of virg_t in a single memory location, used for the 4th argument for opcodes.">virg_var</a>;
<a name="l00316"></a>00316 <span class="comment"></span>
<a name="l00317"></a>00317 <span class="comment">/**</span>
<a name="l00318"></a>00318 <span class="comment"> * @brief Opcode, including arguments</span>
<a name="l00319"></a>00319 <span class="comment"> *</span>
<a name="l00320"></a>00320 <span class="comment"> * This struct is used to store all the attributes of an opcode, including the 3</span>
<a name="l00321"></a>00321 <span class="comment"> * integer arguments and the fourth variable-type argument, in addition to the</span>
<a name="l00322"></a>00322 <span class="comment"> * integer opcode corresponding to an op in the virg_ops enum. The 4 arguments</span>
<a name="l00323"></a>00323 <span class="comment"> * may be option, and their use is entirely dependent on the current opcode</span>
<a name="l00324"></a>00324 <span class="comment"> * being executed.</span>
<a name="l00325"></a>00325 <span class="comment"> */</span>
<a name="l00326"></a><a class="code" href="structvirg__op.html">00326</a> typedef struct {
<a name="l00327"></a>00327         <span class="keywordtype">int</span>                     op;
<a name="l00328"></a>00328         <span class="keywordtype">int</span>                     p1;
<a name="l00329"></a>00329         <span class="keywordtype">int</span>                     p2;
<a name="l00330"></a>00330         <span class="keywordtype">int</span>                     p3;
<a name="l00331"></a>00331         <a class="code" href="unionvirg__var.html" title="Union used to store any of the possible types of virg_t in a single memory location, used for the 4th argument for opcodes.">virg_var</a>        p4;
<a name="l00332"></a>00332 } <a class="code" href="structvirg__op.html" title="Opcode, including arguments.">virg_op</a>;
<a name="l00333"></a>00333 <span class="comment"></span>
<a name="l00334"></a>00334 <span class="comment">/**</span>
<a name="l00335"></a>00335 <span class="comment"> * @brief Linked list node used to manage result tablets</span>
<a name="l00336"></a>00336 <span class="comment"> *</span>
<a name="l00337"></a>00337 <span class="comment"> * The multi-core and GPU virtual machines need to manage their result tablets</span>
<a name="l00338"></a>00338 <span class="comment"> * in a list that is independent of the content of the meta information of the</span>
<a name="l00339"></a>00339 <span class="comment"> * tablets, thus a linked list is used.</span>
<a name="l00340"></a>00340 <span class="comment"> */</span>
<a name="l00341"></a><a class="code" href="structvirg__result__node__.html">00341</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structvirg__result__node__.html" title="Linked list node used to manage result tablets.">virg_result_node_</a>{<span class="comment"></span>
<a name="l00342"></a>00342 <span class="comment">        /// tablet id</span>
<a name="l00343"></a><a class="code" href="structvirg__result__node__.html#a9bc7e6a0a08061ee5ae2130c22e55fe4">00343</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                        <a class="code" href="structvirg__result__node__.html#a9bc7e6a0a08061ee5ae2130c22e55fe4" title="tablet id">id</a>;<span class="comment"></span>
<a name="l00344"></a>00344 <span class="comment">        /// pointer to the next node of the linked list</span>
<a name="l00345"></a><a class="code" href="structvirg__result__node__.html#ae2440fb4659d404f8ff57e4306e69b29">00345</a> <span class="comment"></span>        <span class="keyword">struct </span><a class="code" href="structvirg__result__node__.html" title="Linked list node used to manage result tablets.">virg_result_node_</a>        *<a class="code" href="structvirg__result__node__.html#ae2440fb4659d404f8ff57e4306e69b29" title="pointer to the next node of the linked list">next</a>;
<a name="l00346"></a>00346 } <a class="code" href="virginian_8h.html#a0bfe4609754200e12e70cbd7f6692912" title="Linked list node used to manage result tablets.">virg_result_node</a>;
<a name="l00347"></a>00347 <span class="comment"></span>
<a name="l00348"></a>00348 <span class="comment">/**</span>
<a name="l00349"></a>00349 <span class="comment"> * @brief State struct of the virtual machine context</span>
<a name="l00350"></a>00350 <span class="comment"> *</span>
<a name="l00351"></a>00351 <span class="comment"> * This function is used to manage the virtual machine execution for high-level</span>
<a name="l00352"></a>00352 <span class="comment"> * CPU execution, but further context is needed for the data parallel execution</span>
<a name="l00353"></a>00353 <span class="comment"> * portions. This struct includes the opcode program and pointers to the head</span>
<a name="l00354"></a>00354 <span class="comment"> * and tail nodes of the result tablet list.</span>
<a name="l00355"></a>00355 <span class="comment"> */</span>
<a name="l00356"></a><a class="code" href="structvirg__vm.html">00356</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{<span class="comment"></span>
<a name="l00357"></a>00357 <span class="comment">        /// high-level program counter</span>
<a name="l00358"></a><a class="code" href="structvirg__vm.html#a58a76075e1de12dc9959753f38fb37bc">00358</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                <a class="code" href="structvirg__vm.html#a58a76075e1de12dc9959753f38fb37bc" title="high-level program counter">pc</a>;<span class="comment"></span>
<a name="l00359"></a>00359 <span class="comment">        /// opcode program</span>
<a name="l00360"></a><a class="code" href="structvirg__vm.html#aa1232e0a814aa339153059d9f86320ba">00360</a> <span class="comment"></span>        <a class="code" href="structvirg__op.html" title="Opcode, including arguments.">virg_op</a>                 stmt            [<a class="code" href="virginian_8h.html#a35812eb8ca48e1d30a7c7dd3b4797af4" title="maximum number of query statement opcodes allowed">VIRG_OPS</a>];<span class="comment"></span>
<a name="l00361"></a>00361 <span class="comment">        /// number of opcodes in the opcode program</span>
<a name="l00362"></a><a class="code" href="structvirg__vm.html#a6b42b0c00d2be4bfdfa29404476dade6">00362</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                <a class="code" href="structvirg__vm.html#a6b42b0c00d2be4bfdfa29404476dade6" title="number of opcodes in the opcode program">num_ops</a>;<span class="comment"></span>
<a name="l00363"></a>00363 <span class="comment">        /// high-level registers</span>
<a name="l00364"></a><a class="code" href="structvirg__vm.html#ab5ed3aa6e4230918f8c49e99b3b4219f">00364</a> <span class="comment"></span>        <a class="code" href="unionvirg__var.html" title="Union used to store any of the possible types of virg_t in a single memory location, used for the 4th argument for opcodes.">virg_var</a>                global_reg      [<a class="code" href="virginian_8h.html#ac2542ec287188e6b9d82904c65e0191c" title="number of vm global registers allocated">VIRG_GLOBAL_REGS</a>];<span class="comment"></span>
<a name="l00365"></a>00365 <span class="comment">        /// types currently stored in the high-level registers</span>
<a name="l00366"></a><a class="code" href="structvirg__vm.html#a1ac2c4c3188f29d9a375ad9afc548db5">00366</a> <span class="comment"></span>        <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a>                  type            [<a class="code" href="virginian_8h.html#ac2542ec287188e6b9d82904c65e0191c" title="number of vm global registers allocated">VIRG_GLOBAL_REGS</a>];<span class="comment"></span>
<a name="l00367"></a>00367 <span class="comment">        /// table handles used for the query</span>
<a name="l00368"></a><a class="code" href="structvirg__vm.html#a9d320ceb01e5010039abdb14a800615e">00368</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                table           [<a class="code" href="virginian_8h.html#ae435eb27cbf4eb64670ab0b8bf44db98" title="maximum number of tables to read from supported in vm">VIRG_VM_TABLES</a>];<span class="comment"></span>
<a name="l00369"></a>00369 <span class="comment">        /// number of table handles used</span>
<a name="l00370"></a><a class="code" href="structvirg__vm.html#acdad9572b2e3a5cdb6766c0cdc8c4b66">00370</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                <a class="code" href="structvirg__vm.html#acdad9572b2e3a5cdb6766c0cdc8c4b66" title="number of table handles used">num_tables</a>;<span class="comment"></span>
<a name="l00371"></a>00371 <span class="comment">        /// pointer to the head node of the result tablet list</span>
<a name="l00372"></a><a class="code" href="structvirg__vm.html#adf14bd3fd58a91fa721b5c7ef3d5f9c5">00372</a> <span class="comment"></span>        <a class="code" href="structvirg__result__node__.html" title="Linked list node used to manage result tablets.">virg_result_node</a>        *<a class="code" href="structvirg__vm.html#adf14bd3fd58a91fa721b5c7ef3d5f9c5" title="pointer to the head node of the result tablet list">head_result</a>;<span class="comment"></span>
<a name="l00373"></a>00373 <span class="comment">        /// pointer to the tail node of the result tablet list</span>
<a name="l00374"></a><a class="code" href="structvirg__vm.html#ae73ae2d846b279bc522b56c37b048978">00374</a> <span class="comment"></span>        <a class="code" href="structvirg__result__node__.html" title="Linked list node used to manage result tablets.">virg_result_node</a>        *<a class="code" href="structvirg__vm.html#ae73ae2d846b279bc522b56c37b048978" title="pointer to the tail node of the result tablet list">tail_result</a>;<span class="comment"></span>
<a name="l00375"></a>00375 <span class="comment">        /// used to return timing data</span>
<a name="l00376"></a><a class="code" href="structvirg__vm.html#a3380d86fd8d1a245625e78e974a7eaa4">00376</a> <span class="comment"></span>        <span class="keywordtype">float</span>                   <a class="code" href="structvirg__vm.html#a3380d86fd8d1a245625e78e974a7eaa4" title="used to return timing data">timing1</a>, timing2, timing3;
<a name="l00377"></a>00377 } <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a>;
<a name="l00378"></a>00378 <span class="comment"></span>
<a name="l00379"></a>00379 <span class="comment">/**</span>
<a name="l00380"></a>00380 <span class="comment"> * @brief Lower-level GPU virtual machine context</span>
<a name="l00381"></a>00381 <span class="comment"> *</span>
<a name="l00382"></a>00382 <span class="comment"> * This is used to store the registers associated with virtual machine execution</span>
<a name="l00383"></a>00383 <span class="comment"> * on the GPU. Note that each thread manages its program counter independently,</span>
<a name="l00384"></a>00384 <span class="comment"> * and thus it is not included in this context.</span>
<a name="l00385"></a>00385 <span class="comment"> */</span>
<a name="l00386"></a><a class="code" href="structvirg__vm__context.html">00386</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{<span class="comment"></span>
<a name="l00387"></a>00387 <span class="comment">        /// registers</span>
<a name="l00388"></a><a class="code" href="structvirg__vm__context.html#a289ebb127f313cd9615ae916a449990b">00388</a> <span class="comment"></span>        <a class="code" href="unionvirg__var.html" title="Union used to store any of the possible types of virg_t in a single memory location, used for the 4th argument for opcodes.">virg_var</a>                <a class="code" href="structreg.html" title="connects a vm register to an expression">reg</a>                     [<a class="code" href="virginian_8h.html#a97265ed63626e0bd7a2bb4b7ad8fb661" title="number of vm registers allocated">VIRG_REGS</a>];<span class="comment"></span>
<a name="l00389"></a>00389 <span class="comment">        /// variable type currently stored in registers</span>
<a name="l00390"></a><a class="code" href="structvirg__vm__context.html#a8a0dce5ea4398c63c149bff11013ae90">00390</a> <span class="comment"></span>        <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a>                  type            [<a class="code" href="virginian_8h.html#a97265ed63626e0bd7a2bb4b7ad8fb661" title="number of vm registers allocated">VIRG_REGS</a>];<span class="comment"></span>
<a name="l00391"></a>00391 <span class="comment">        /// size in bytes of the variable stored in registers</span>
<a name="l00392"></a><a class="code" href="structvirg__vm__context.html#a50e99c1c0386f472b1a482500c186d41">00392</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>                  stride          [<a class="code" href="virginian_8h.html#a97265ed63626e0bd7a2bb4b7ad8fb661" title="number of vm registers allocated">VIRG_REGS</a>];
<a name="l00393"></a>00393 }<a class="code" href="structvirg__vm__context.html" title="Lower-level GPU virtual machine context.">virg_vm_context</a>;
<a name="l00394"></a>00394 <span class="comment"></span>
<a name="l00395"></a>00395 <span class="comment">/**</span>
<a name="l00396"></a>00396 <span class="comment"> * @brief Lower-level data parallel CPU virtual machine context</span>
<a name="l00397"></a>00397 <span class="comment"> *</span>
<a name="l00398"></a>00398 <span class="comment"> * This is the cache-efficient data structure used to store intermediate</span>
<a name="l00399"></a>00399 <span class="comment"> * information for CPU virtual machine execution. The VIRG_CPU_SIMD macro</span>
<a name="l00400"></a>00400 <span class="comment"> * specifies the size of the row blocks that are processed in one step on the</span>
<a name="l00401"></a>00401 <span class="comment"> * CPU. Note that the registers are blocked for data-parallel execution, so</span>
<a name="l00402"></a>00402 <span class="comment"> * the data used by different rows in the same register location is adjacent.</span>
<a name="l00403"></a>00403 <span class="comment"> * This is accomplished with the array of unions. Also note that the type and</span>
<a name="l00404"></a>00404 <span class="comment"> * stride of each register only needs to be stored once per register, because</span>
<a name="l00405"></a>00405 <span class="comment"> * everything is SIMD in a row block.</span>
<a name="l00406"></a>00406 <span class="comment"> */</span>
<a name="l00407"></a><a class="code" href="structvirg__vm__simdcontext.html">00407</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{<span class="comment"></span>
<a name="l00408"></a>00408 <span class="comment">        /// global program counter</span>
<a name="l00409"></a><a class="code" href="structvirg__vm__simdcontext.html#a1aeef8a6559545c81e502985f63c28ee">00409</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                <a class="code" href="structvirg__vm__simdcontext.html#a1aeef8a6559545c81e502985f63c28ee" title="global program counter">pc</a>;<span class="comment"></span>
<a name="l00410"></a>00410 <span class="comment">        /// program counter for individual rows in the block</span>
<a name="l00411"></a><a class="code" href="structvirg__vm__simdcontext.html#a9422c8e06f212c5c20c4834d593f7d64">00411</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                row_pc [<a class="code" href="virginian_8h.html#a6b039207848380e774147e035d3876c0" title="number of rows to process on the cpu in a block">VIRG_CPU_SIMD</a>];<span class="comment"></span>
<a name="l00412"></a>00412 <span class="comment">        /// block-organized registers</span>
<a name="l00413"></a>00413 <span class="comment"></span>        <span class="keyword">union </span>{
<a name="l00414"></a>00414                 <span class="keywordtype">int</span>                     i       [<a class="code" href="virginian_8h.html#a6b039207848380e774147e035d3876c0" title="number of rows to process on the cpu in a block">VIRG_CPU_SIMD</a>];
<a name="l00415"></a>00415                 <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>   li      [<a class="code" href="virginian_8h.html#a6b039207848380e774147e035d3876c0" title="number of rows to process on the cpu in a block">VIRG_CPU_SIMD</a>];
<a name="l00416"></a>00416                 <span class="keywordtype">float</span>           f       [<a class="code" href="virginian_8h.html#a6b039207848380e774147e035d3876c0" title="number of rows to process on the cpu in a block">VIRG_CPU_SIMD</a>];
<a name="l00417"></a>00417                 <span class="keywordtype">double</span>          d       [<a class="code" href="virginian_8h.html#a6b039207848380e774147e035d3876c0" title="number of rows to process on the cpu in a block">VIRG_CPU_SIMD</a>];
<a name="l00418"></a>00418                 <span class="keywordtype">char</span>            c       [<a class="code" href="virginian_8h.html#a6b039207848380e774147e035d3876c0" title="number of rows to process on the cpu in a block">VIRG_CPU_SIMD</a>];
<a name="l00419"></a>00419                 <span class="keywordtype">char</span>            *s      [<a class="code" href="virginian_8h.html#a6b039207848380e774147e035d3876c0" title="number of rows to process on the cpu in a block">VIRG_CPU_SIMD</a>];
<a name="l00420"></a>00420         } <a class="code" href="structreg.html" title="connects a vm register to an expression">reg</a>[<a class="code" href="virginian_8h.html#a97265ed63626e0bd7a2bb4b7ad8fb661" title="number of vm registers allocated">VIRG_REGS</a>];<span class="comment"></span>
<a name="l00421"></a>00421 <span class="comment">        /// type stored in each register</span>
<a name="l00422"></a><a class="code" href="structvirg__vm__simdcontext.html#a034886f5283b9d5118e6ace5117642c5">00422</a> <span class="comment"></span>        <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a>                  type    [<a class="code" href="virginian_8h.html#a97265ed63626e0bd7a2bb4b7ad8fb661" title="number of vm registers allocated">VIRG_REGS</a>];<span class="comment"></span>
<a name="l00423"></a>00423 <span class="comment">        /// size in bytes of the variable stored in each registers</span>
<a name="l00424"></a><a class="code" href="structvirg__vm__simdcontext.html#ac0799f5fb43cb6394ce29222d3506328">00424</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>                  stride  [<a class="code" href="virginian_8h.html#a97265ed63626e0bd7a2bb4b7ad8fb661" title="number of vm registers allocated">VIRG_REGS</a>];
<a name="l00425"></a>00425 } <a class="code" href="structvirg__vm__simdcontext.html" title="Lower-level data parallel CPU virtual machine context.">virg_vm_simdcontext</a>;
<a name="l00426"></a>00426 <span class="comment"></span>
<a name="l00427"></a>00427 <span class="comment">/**</span>
<a name="l00428"></a>00428 <span class="comment"> * @brief State of the currently open database</span>
<a name="l00429"></a>00429 <span class="comment"> *</span>
<a name="l00430"></a>00430 <span class="comment"> * This structure is used to manage the database file that is currently open in</span>
<a name="l00431"></a>00431 <span class="comment"> * the database. It is the head of the database file, is loaded into memory when</span>
<a name="l00432"></a>00432 <span class="comment"> * the database is opened, and is accessed in memory until the database is</span>
<a name="l00433"></a>00433 <span class="comment"> * closed, when it is written to the start of the table. This has a fixed size,</span>
<a name="l00434"></a>00434 <span class="comment"> * but the list of tablets in the database managed with virg_tablet_info structs</span>
<a name="l00435"></a>00435 <span class="comment"> * necessarily has a variable size, and is stored just after this on disk.</span>
<a name="l00436"></a>00436 <span class="comment"> *</span>
<a name="l00437"></a>00437 <span class="comment"> * Note that the fd (file descriptor) variable is meaningless when this data</span>
<a name="l00438"></a>00438 <span class="comment"> * is written to disk.</span>
<a name="l00439"></a>00439 <span class="comment"> */</span>
<a name="l00440"></a><a class="code" href="structvirg__db.html">00440</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{<span class="comment"></span>
<a name="l00441"></a>00441 <span class="comment">        /// number of tablets on disk</span>
<a name="l00442"></a><a class="code" href="structvirg__db.html#a76f65c11efb2f4331dda033edfa513c2">00442</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                <a class="code" href="structvirg__db.html#a76f65c11efb2f4331dda033edfa513c2" title="number of tablets on disk">num_tablets</a>;<span class="comment"></span>
<a name="l00443"></a>00443 <span class="comment">        /// number of virg_tablet_info structs that have been allocated</span>
<a name="l00444"></a><a class="code" href="structvirg__db.html#a071548caca50ad0408ca5f81cd82d898">00444</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                <a class="code" href="structvirg__db.html#a071548caca50ad0408ca5f81cd82d898" title="number of virg_tablet_info structs that have been allocated">alloced_tablets</a>;<span class="comment"></span>
<a name="l00445"></a>00445 <span class="comment">        /// used to assign unique ids to each data and result tablet</span>
<a name="l00446"></a><a class="code" href="structvirg__db.html#a6657ccb6b05ec1b98ff5d5e868f4e1bc">00446</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                <a class="code" href="structvirg__db.html#a6657ccb6b05ec1b98ff5d5e868f4e1bc" title="used to assign unique ids to each data and result tablet">tablet_id_counter</a>;<span class="comment"></span>
<a name="l00447"></a>00447 <span class="comment">        /// size of this struct plus all the virg_tablet_info structs</span>
<a name="l00448"></a><a class="code" href="structvirg__db.html#a3c79e95bc329543a931b29c57a4a829b">00448</a> <span class="comment"></span>        <span class="keywordtype">size_t</span>                  <a class="code" href="structvirg__db.html#a3c79e95bc329543a931b29c57a4a829b" title="size of this struct plus all the virg_tablet_info structs">block_size</a>;<span class="comment"></span>
<a name="l00449"></a>00449 <span class="comment">        /// maps table id to name</span>
<a name="l00450"></a><a class="code" href="structvirg__db.html#a581c152d798171bbe487a67b4e2d1471">00450</a> <span class="comment"></span>        <span class="keywordtype">char</span>                    tables[<a class="code" href="virginian_8h.html#a6b400ca21647bb81159b1c459ef053e2" title="maximum tables supported">VIRG_MAX_TABLES</a>][<a class="code" href="virginian_8h.html#a3dc8d40b3fe67f3576cf3e6336efdcdf" title="maximum table name length supported">VIRG_MAX_TABLE_NAME</a>];<span class="comment"></span>
<a name="l00451"></a>00451 <span class="comment">        /// maps table id to the id of its first tablet</span>
<a name="l00452"></a><a class="code" href="structvirg__db.html#a1e3f0138b4b0b6b9e631fae4dad9f7a1">00452</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                first_tablet[<a class="code" href="virginian_8h.html#a6b400ca21647bb81159b1c459ef053e2" title="maximum tables supported">VIRG_MAX_TABLES</a>];<span class="comment"></span>
<a name="l00453"></a>00453 <span class="comment">        /// maps table id to the id of its last tablet</span>
<a name="l00454"></a><a class="code" href="structvirg__db.html#ac8560755766ec57cc30bd45c972242bd">00454</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                last_tablet[<a class="code" href="virginian_8h.html#a6b400ca21647bb81159b1c459ef053e2" title="maximum tables supported">VIRG_MAX_TABLES</a>];<span class="comment"></span>
<a name="l00455"></a>00455 <span class="comment">        /// tablet id of the current write location for adding rows to a table</span>
<a name="l00456"></a><a class="code" href="structvirg__db.html#aab4e0db684c30a32f0cc82f25274c576">00456</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                write_cursor[<a class="code" href="virginian_8h.html#a6b400ca21647bb81159b1c459ef053e2" title="maximum tables supported">VIRG_MAX_TABLES</a>];<span class="comment"></span>
<a name="l00457"></a>00457 <span class="comment">        /// number of tablets for each table</span>
<a name="l00458"></a><a class="code" href="structvirg__db.html#acd5ea5ce0d1eaf0910665ba8db39161c">00458</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                table_tablets[<a class="code" href="virginian_8h.html#a6b400ca21647bb81159b1c459ef053e2" title="maximum tables supported">VIRG_MAX_TABLES</a>];<span class="comment"></span>
<a name="l00459"></a>00459 <span class="comment">        /// note which table slots have been used</span>
<a name="l00460"></a><a class="code" href="structvirg__db.html#a5f9dfe5476b490458ef529b57508cfb2">00460</a> <span class="comment"></span>        <span class="keywordtype">int</span>                             table_status[<a class="code" href="virginian_8h.html#a6b400ca21647bb81159b1c459ef053e2" title="maximum tables supported">VIRG_MAX_TABLES</a>];<span class="comment"></span>
<a name="l00461"></a>00461 <span class="comment">        /// pointer to the block allocated to store virg_tablet_info structs</span>
<a name="l00462"></a><a class="code" href="structvirg__db.html#a26636f8d326509af7c3faa1d41e76472">00462</a> <span class="comment"></span>        <a class="code" href="structvirg__tablet__info.html" title="Information associated with a tablet on disk.">virg_tablet_info</a>        *<a class="code" href="structvirg__db.html#a26636f8d326509af7c3faa1d41e76472" title="pointer to the block allocated to store virg_tablet_info structs">tablet_info</a>;
<a name="l00463"></a>00463 } <a class="code" href="structvirg__db.html" title="State of the currently open database.">virg_db</a>;
<a name="l00464"></a>00464 <span class="comment"></span>
<a name="l00465"></a>00465 <span class="comment">/**</span>
<a name="l00466"></a>00466 <span class="comment"> * @brief State struct of the whole database</span>
<a name="l00467"></a>00467 <span class="comment"> *</span>
<a name="l00468"></a>00468 <span class="comment"> * This is used to manage the overall state of Virginian. It is used in almost</span>
<a name="l00469"></a>00469 <span class="comment"> * all function calls and must be initialized and closed with the appropriate</span>
<a name="l00470"></a>00470 <span class="comment"> * functions. This holds the tablet slot allocations, virg_db struct, and</span>
<a name="l00471"></a>00471 <span class="comment"> * virtual machine execution options.</span>
<a name="l00472"></a>00472 <span class="comment"> */</span>
<a name="l00473"></a><a class="code" href="structvirginian.html">00473</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{<span class="comment"></span>
<a name="l00474"></a>00474 <span class="comment">        /// database file state</span>
<a name="l00475"></a><a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7">00475</a> <span class="comment"></span>        <a class="code" href="structvirg__db.html" title="State of the currently open database.">virg_db</a>                 <a class="code" href="structvirginian.html#a4475e39a0380efc27a50823d7fc11cb7" title="database file state">db</a>;<span class="comment"></span>
<a name="l00476"></a>00476 <span class="comment">        /// id of the tablet in each slot, valid only if status is above 0</span>
<a name="l00477"></a><a class="code" href="structvirginian.html#acf3ed38504bbb207ffa500d1508cad97">00477</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                tablet_slot_ids         [<a class="code" href="virginian_8h.html#a9c6e6ed866369d7cc0288fafd223a87b" title="tablet slots to allocate in memory">VIRG_MEM_TABLETS</a>];<span class="comment"></span>
<a name="l00478"></a>00478 <span class="comment">        /// use status of the tablet slot, 0 for unused, 1 for used, &gt;1 for each lock</span>
<a name="l00479"></a><a class="code" href="structvirginian.html#ae6776e19e678dca8d07646de4ad8ae8c">00479</a> <span class="comment"></span>        <span class="keywordtype">int</span>                             tablet_slot_status      [<a class="code" href="virginian_8h.html#a9c6e6ed866369d7cc0288fafd223a87b" title="tablet slots to allocate in memory">VIRG_MEM_TABLETS</a>];<span class="comment"></span>
<a name="l00480"></a>00480 <span class="comment">        /// number of tablet slots which are unused</span>
<a name="l00481"></a><a class="code" href="structvirginian.html#ab4ab09cb712e32031e114b442c0c8157">00481</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                <a class="code" href="structvirginian.html#ab4ab09cb712e32031e114b442c0c8157" title="number of tablet slots which are unused">tablet_slots_taken</a>;<span class="comment"></span>
<a name="l00482"></a>00482 <span class="comment">        /// round-robin counter to kick out tablets</span>
<a name="l00483"></a><a class="code" href="structvirginian.html#a5decd7c40e471d59f7d423669495f13a">00483</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                <a class="code" href="structvirginian.html#a5decd7c40e471d59f7d423669495f13a" title="round-robin counter to kick out tablets">tablet_slot_counter</a>;<span class="comment"></span>
<a name="l00484"></a>00484 <span class="comment">        /// pointer to each main-memory tablet slot</span>
<a name="l00485"></a><a class="code" href="structvirginian.html#a5b2712b05652c6c884e7550c15a86428">00485</a> <span class="comment"></span>        <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a>        *tablet_slots           [<a class="code" href="virginian_8h.html#a9c6e6ed866369d7cc0288fafd223a87b" title="tablet slots to allocate in memory">VIRG_MEM_TABLETS</a>];<span class="comment"></span>
<a name="l00486"></a>00486 <span class="comment">        /// pointer to the beginning of the allocated gpu tablet slots</span>
<a name="l00487"></a><a class="code" href="structvirginian.html#a8cf3b95984dce9135f5937237bdabdb8">00487</a> <span class="comment"></span>        <span class="keywordtype">void</span>                    *<a class="code" href="structvirginian.html#a8cf3b95984dce9135f5937237bdabdb8" title="pointer to the beginning of the allocated gpu tablet slots">gpu_slots</a>;<span class="comment"></span>
<a name="l00488"></a>00488 <span class="comment">        /// mutex for multi-core manipulation of the tablet slots</span>
<a name="l00489"></a><a class="code" href="structvirginian.html#a26ed4b0163e1b8a4ac20898715519588">00489</a> <span class="comment"></span>        pthread_mutex_t         <a class="code" href="structvirginian.html#a26ed4b0163e1b8a4ac20898715519588" title="mutex for multi-core manipulation of the tablet slots">slot_lock</a>;<span class="comment"></span>
<a name="l00490"></a>00490 <span class="comment">        /// file descriptor for the open database</span>
<a name="l00491"></a><a class="code" href="structvirginian.html#a736058b8d4409694d3d6013b4d92bcee">00491</a> <span class="comment"></span>        <span class="keywordtype">int</span>                     <a class="code" href="structvirginian.html#a736058b8d4409694d3d6013b4d92bcee" title="file descriptor for the open database">dbfd</a>;<span class="comment"></span>
<a name="l00492"></a>00492 <span class="comment">        /// threads per block for gpu execution</span>
<a name="l00493"></a><a class="code" href="structvirginian.html#a2820593ec616cb2093cabb74e7affa5e">00493</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>        <a class="code" href="structvirginian.html#a2820593ec616cb2093cabb74e7affa5e" title="threads per block for gpu execution">threads_per_block</a>;<span class="comment"></span>
<a name="l00494"></a>00494 <span class="comment">        /// number of threads to use for multi-core cpu execution</span>
<a name="l00495"></a><a class="code" href="structvirginian.html#aa09161b8fdfc2f003a751bde3268677d">00495</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>        <a class="code" href="structvirginian.html#aa09161b8fdfc2f003a751bde3268677d" title="number of threads to use for multi-core cpu execution">multi_threads</a>;<span class="comment"></span>
<a name="l00496"></a>00496 <span class="comment">        /// enables multicore</span>
<a name="l00497"></a><a class="code" href="structvirginian.html#add73a147022b2ac21e84dcf50781a7f0">00497</a> <span class="comment"></span>        <span class="keywordtype">int</span>                     <a class="code" href="structvirginian.html#add73a147022b2ac21e84dcf50781a7f0" title="enables multicore">use_multi</a>;<span class="comment"></span>
<a name="l00498"></a>00498 <span class="comment">        /// enables gpu execution</span>
<a name="l00499"></a><a class="code" href="structvirginian.html#ae93e73cfddaddff800b4d6e11204c8a7">00499</a> <span class="comment"></span>        <span class="keywordtype">int</span>                     <a class="code" href="structvirginian.html#ae93e73cfddaddff800b4d6e11204c8a7" title="enables gpu execution">use_gpu</a>;<span class="comment"></span>
<a name="l00500"></a>00500 <span class="comment">        /// enables stream execution</span>
<a name="l00501"></a><a class="code" href="structvirginian.html#af361324ce5a460bc8e54b6ccde5c5c47">00501</a> <span class="comment"></span>        <span class="keywordtype">int</span>                     <a class="code" href="structvirginian.html#af361324ce5a460bc8e54b6ccde5c5c47" title="enables stream execution">use_stream</a>;<span class="comment"></span>
<a name="l00502"></a>00502 <span class="comment">        /// enables mapped execution, only used if stream is false</span>
<a name="l00503"></a><a class="code" href="structvirginian.html#aa3e6f75167f32ecdadd72f330f4b5a31">00503</a> <span class="comment"></span>        <span class="keywordtype">int</span>                     <a class="code" href="structvirginian.html#aa3e6f75167f32ecdadd72f330f4b5a31" title="enables mapped execution, only used if stream is false">use_mmap</a>;
<a name="l00504"></a>00504 } <a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a>;
<a name="l00505"></a>00505 <span class="comment"></span>
<a name="l00506"></a>00506 <span class="comment">/**</span>
<a name="l00507"></a>00507 <span class="comment"> * @brief Holds the arguments for the multicore GPU virtual machine</span>
<a name="l00508"></a>00508 <span class="comment"> *</span>
<a name="l00509"></a>00509 <span class="comment"> * The virtual machine is run directly from pthread_create(), which can only</span>
<a name="l00510"></a>00510 <span class="comment"> * pass a single argument to the function, so this struct is used to package</span>
<a name="l00511"></a>00511 <span class="comment"> * arguments together.</span>
<a name="l00512"></a>00512 <span class="comment"> */</span>
<a name="l00513"></a><a class="code" href="structvirg__vm__arg.html">00513</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00514"></a>00514         <a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a>               *v;
<a name="l00515"></a>00515         <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a>                 *<a class="code" href="vm__gpu_8cu.html#a946d0d35b3bc20faef9b521a79e7e89a" title="GPU constant memory variable to hold the virtual machine execution context.">vm</a>;
<a name="l00516"></a>00516         <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a>        *tab;
<a name="l00517"></a>00517         <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a>        *res;
<a name="l00518"></a>00518         <span class="keywordtype">unsigned</span>                row;
<a name="l00519"></a>00519         <span class="keywordtype">unsigned</span>                num_rows;
<a name="l00520"></a>00520         <span class="keywordtype">unsigned</span>                num_tablets;
<a name="l00521"></a>00521         <span class="keywordtype">unsigned</span>                tablets_proced;
<a name="l00522"></a>00522         pthread_mutex_t         tab_lock;
<a name="l00523"></a>00523         pthread_mutex_t         res_lock;
<a name="l00524"></a>00524 } <a class="code" href="structvirg__vm__arg.html" title="Holds the arguments for the multicore GPU virtual machine.">virg_vm_arg</a>;
<a name="l00525"></a>00525 <span class="comment"></span>
<a name="l00526"></a>00526 <span class="comment">/**</span>
<a name="l00527"></a>00527 <span class="comment"> * @brief State of the results reader object</span>
<a name="l00528"></a>00528 <span class="comment"> *</span>
<a name="l00529"></a>00529 <span class="comment"> * This stores the current cursor location of a result reader and holds the</span>
<a name="l00530"></a>00530 <span class="comment"> * buffer through which row information is returned</span>
<a name="l00531"></a>00531 <span class="comment"> */</span>
<a name="l00532"></a><a class="code" href="structvirg__reader.html">00532</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{<span class="comment"></span>
<a name="l00533"></a>00533 <span class="comment">        /// virtual machine context from which the results are taken</span>
<a name="l00534"></a><a class="code" href="structvirg__reader.html#ae8db84ecef576b4d02a698d1f0229b4a">00534</a> <span class="comment"></span>        <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a>                 *<a class="code" href="structvirg__reader.html#ae8db84ecef576b4d02a698d1f0229b4a" title="virtual machine context from which the results are taken">vm</a>;<span class="comment"></span>
<a name="l00535"></a>00535 <span class="comment">        /// pointer to the current results object</span>
<a name="l00536"></a><a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f">00536</a> <span class="comment"></span>        <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a>        *<a class="code" href="structvirg__reader.html#a2a7fe50769633c9891ad37126fe3760f" title="pointer to the current results object">res</a>;<span class="comment"></span>
<a name="l00537"></a>00537 <span class="comment">        /// current result row</span>
<a name="l00538"></a><a class="code" href="structvirg__reader.html#a6fb34f3a45d5b9dc7a5804a5e0c0720a">00538</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span>                <a class="code" href="structvirg__reader.html#a6fb34f3a45d5b9dc7a5804a5e0c0720a" title="current result row">row</a>;<span class="comment"></span>
<a name="l00539"></a>00539 <span class="comment">        /// buffer to hold the contents of returned rows</span>
<a name="l00540"></a><a class="code" href="structvirg__reader.html#a14e15bcb913a6821425827a6c06be298">00540</a> <span class="comment"></span>        <span class="keywordtype">char</span>                    buffer  [<a class="code" href="virginian_8h.html#a3bb0ed9071587928925932e169a02985" title="buffer size to store a single row in virg_reader">VIRG_ROW_BUFFER</a>];
<a name="l00541"></a>00541 } <a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a>;
<a name="l00542"></a>00542 <span class="comment"></span>
<a name="l00543"></a>00543 <span class="comment">/**</span>
<a name="l00544"></a>00544 <span class="comment"> * @brief Array of data structure sizes used for testing</span>
<a name="l00545"></a>00545 <span class="comment"> *</span>
<a name="l00546"></a>00546 <span class="comment"> * There are certain instances where data structures compile with different</span>
<a name="l00547"></a>00547 <span class="comment"> * sizes on gcc/icc versus nvcc because of different optimization criteria. For</span>
<a name="l00548"></a>00548 <span class="comment"> * example, structs will get rounded up to a power of 2 on one platform but not</span>
<a name="l00549"></a>00549 <span class="comment"> * the other. This creates bugs which are extremely difficult to diagnose. This</span>
<a name="l00550"></a>00550 <span class="comment"> * array is used by the testing code to ensure that all data types are identical</span>
<a name="l00551"></a>00551 <span class="comment"> * between cpu and gpu code.</span>
<a name="l00552"></a>00552 <span class="comment"> */</span>
<a name="l00553"></a>00553 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> virg_testsizes[15] = {
<a name="l00554"></a>00554         <span class="keyword">sizeof</span>(int),
<a name="l00555"></a>00555         <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),
<a name="l00556"></a>00556         <span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int),
<a name="l00557"></a>00557         <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),
<a name="l00558"></a>00558         <span class="keyword">sizeof</span>(char),
<a name="l00559"></a>00559         <span class="keyword">sizeof</span>(<a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a>),
<a name="l00560"></a>00560         <span class="keyword">sizeof</span>(<a class="code" href="structvirg__tablet__info.html" title="Information associated with a tablet on disk.">virg_tablet_info</a>),
<a name="l00561"></a>00561         <span class="keyword">sizeof</span>(<a class="code" href="unionvirg__var.html" title="Union used to store any of the possible types of virg_t in a single memory location, used for the 4th argument for opcodes.">virg_var</a>),
<a name="l00562"></a>00562         <span class="keyword">sizeof</span>(<a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a>),
<a name="l00563"></a>00563         <span class="keyword">sizeof</span>(<a class="code" href="structvirg__op.html" title="Opcode, including arguments.">virg_op</a>),
<a name="l00564"></a>00564         <span class="keyword">sizeof</span>(<a class="code" href="virginian_8h.html#a0bfe4609754200e12e70cbd7f6692912" title="Linked list node used to manage result tablets.">virg_result_node</a>),
<a name="l00565"></a>00565         <span class="keyword">sizeof</span>(<a class="code" href="structvirg__db.html" title="State of the currently open database.">virg_db</a>),
<a name="l00566"></a>00566         <span class="keyword">sizeof</span>(<a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a>),
<a name="l00567"></a>00567         <span class="keyword">sizeof</span>(<a class="code" href="structvirg__vm__arg.html" title="Holds the arguments for the multicore GPU virtual machine.">virg_vm_arg</a>),
<a name="l00568"></a>00568         <span class="keyword">sizeof</span>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a>)
<a name="l00569"></a>00569 };
<a name="l00570"></a>00570 
<a name="l00571"></a>00571 <span class="keywordtype">int</span> <a class="code" href="group__database.html#gaa6d6a3af446d22e836e0acc488db0348" title="Allocate a tablet slot and return a pointer to it.">virg_db_alloc</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> **<a class="code" href="vm__gpu_8cu.html#a98365893b0ed61f342c55a901d47b738">meta</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>);
<a name="l00572"></a>00572 <span class="keywordtype">int</span> <a class="code" href="group__database.html#gabbd5a202240db94bc243bab127c8157d" title="Open an existing database file.">virg_db_open</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *file);
<a name="l00573"></a>00573 <span class="keywordtype">int</span> <a class="code" href="group__database.html#ga1d9e0bce415badbfb3fc06c0021d9de4" title="Create and initialize a new database.">virg_db_create</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *file);
<a name="l00574"></a>00574 <span class="keywordtype">int</span> <a class="code" href="group__database.html#ga8e2d3e3bf58554a5c2b58372c2211b66" title="Close the currently opened database.">virg_db_close</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v);
<a name="l00575"></a>00575 <span class="keywordtype">int</span> <a class="code" href="group__database.html#ga7a90f2b2186befe31067d4c13d3fa168" title="Clear out a certain tablet slot.">virg_db_clear</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> slot);
<a name="l00576"></a>00576 <span class="keywordtype">int</span> <a class="code" href="group__database.html#gabba43a66f14c5ad7172401aa0005261f" title="Write the tablet in a tablet slot to disk.">virg_db_write</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> slot);
<a name="l00577"></a>00577 <span class="keywordtype">int</span> <a class="code" href="group__database.html#ga45ebb12f5cd1cb668f06dcc64fd815a0" title="Load a tablet into a slot based on its ID and return a pointer.">virg_db_load</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> tablet_id, <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> **tab);
<a name="l00578"></a>00578 <span class="keywordtype">int</span> <a class="code" href="group__database.html#ga78584f2bb7ca78e1cb87378929ce40f2" title="Advance a tablet pointer to the next tablet in its string of tablets.">virg_db_loadnext</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> **tab);
<a name="l00579"></a>00579 <span class="keywordtype">int</span> <a class="code" href="group__database.html#ga82086192c59cb1cb6dce14cbccdc4554" title="Find an empty or unlocked tablet slot.">virg_db_findslot</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> *slot_);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 <span class="keywordtype">int</span> <a class="code" href="group__table.html#gabe254310e06db8843964bfed82dd4d67" title="Add a column to every tablet in the table.">virg_table_addcolumn</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v,
<a name="l00582"></a>00582         <span class="keywordtype">unsigned</span> table_id, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a> type);
<a name="l00583"></a>00583 <span class="keywordtype">int</span> <a class="code" href="group__table.html#gabd464f256a1d2645488e015f4a6da1b3" title="Create a new table.">virg_table_create</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a> key_type);
<a name="l00584"></a>00584 <span class="keywordtype">int</span> <a class="code" href="group__table.html#ga485a975e2aeb00880732eac8c6ad28ee" title="Insert a row into a table.">virg_table_insert</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> table_id, <span class="keywordtype">char</span> *key,
<a name="l00585"></a>00585         <span class="keywordtype">char</span> *data, <span class="keywordtype">char</span> *blob);
<a name="l00586"></a>00586 <span class="keywordtype">int</span> <a class="code" href="group__table.html#gab12cd9a6b1b3e72b9ebe90348cf3cb8c" title="Load as many tablets from a table into memory as possible.">virg_table_loadmem</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> table_id);
<a name="l00587"></a>00587 <span class="keywordtype">int</span> <a class="code" href="group__table.html#gae353f4b3d8c2a907abc94a1e9dd33a55" title="Find the ID of a table given its name.">virg_table_getid</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">unsigned</span> *<span class="keywordtype">id</span>);
<a name="l00588"></a>00588 <span class="keywordtype">int</span> <a class="code" href="group__table.html#ga9232ad719d86ce12da634af477c0181d" title="Find the ID of a table column given its name.">virg_table_getcolumn</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> tid, <span class="keyword">const</span> <span class="keywordtype">char</span>* name,
<a name="l00589"></a>00589         <span class="keywordtype">unsigned</span> *<span class="keywordtype">id</span>);
<a name="l00590"></a>00590 <span class="keywordtype">int</span> <a class="code" href="group__table.html#ga04c8f0729122ef8406e1a6c918bc4da6" title="Find the type of a table column.">virg_table_getcolumntype</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> tid, <span class="keywordtype">unsigned</span> cid,
<a name="l00591"></a>00591         <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a> *type);
<a name="l00592"></a>00592 <span class="keywordtype">int</span> <a class="code" href="group__table.html#ga94b2fe975e966c73b9790562c9004e35" title="Find the type of a table&#39;s key.">virg_table_getkeytype</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> tid, <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a> *type);
<a name="l00593"></a>00593 <span class="keywordtype">int</span> <a class="code" href="group__table.html#ga8a997c77187e090360e92c200f2249cf" title="Iterate over each table in the database to find the one who&#39;s name matches the given string...">virg_table_numrows</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> <span class="keywordtype">id</span>, <span class="keywordtype">unsigned</span> *rows);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595 <span class="keywordtype">int</span> <a class="code" href="group__tablet.html#gad8e8dfe554d09257dbccd44b7bc35f2c" title="Add a column to a tablet.">virg_tablet_addcolumn</a>(<a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a> type);
<a name="l00596"></a>00596 <span class="keywordtype">int</span> <a class="code" href="group__tablet.html#gad8a1519a69a43f924a94cec0a691392c" title="Add fixed-size rows to a tablet.">virg_tablet_addrows</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab, <span class="keywordtype">unsigned</span> rows);
<a name="l00597"></a>00597 <span class="keywordtype">int</span> <a class="code" href="group__tablet.html#ga91abf3ca31d24bdc6be4b30ca0840d03" title="Maximize the fixed-size block of the tablet.">virg_tablet_addmaxrows</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab);
<a name="l00598"></a>00598 <span class="keywordtype">int</span> <a class="code" href="group__tablet.html#gac81bdeda780fac6917c8942bec57a581" title="Create an empty tablet for a new table.">virg_tablet_create</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">int</span> *<span class="keywordtype">id</span>, <a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a> key_type,
<a name="l00599"></a>00599         <span class="keywordtype">unsigned</span> table_id);
<a name="l00600"></a>00600 <span class="keywordtype">int</span> <a class="code" href="group__tablet.html#ga63806dc508073da387d045837f0d7e9d" title="Ensure that the tablet is internally consistent and conforms to expectation.">virg_tablet_check</a>(<a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *t);
<a name="l00601"></a>00601 <span class="keywordtype">int</span> <a class="code" href="group__tablet.html#gaaa3df8caa444c2afb156e0b4673fc492" title="Grows the fixed_block of a tablet by moving the variable block back.">virg_tablet_growfixed</a>(<a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab, <span class="keywordtype">size_t</span> size);
<a name="l00602"></a>00602 <span class="keywordtype">int</span> <a class="code" href="group__tablet.html#gabd69b51cf1469c95d1574b1d53935391" title="Add a lock to a tablet.">virg_tablet_lock</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> tablet_id);
<a name="l00603"></a>00603 <span class="keywordtype">int</span> <a class="code" href="group__tablet.html#ga8e6a3f46a4efe9347c8202acc032db69" title="Release a lock to a tablet.">virg_tablet_unlock</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> tablet_id);
<a name="l00604"></a>00604 <span class="keywordtype">int</span> <a class="code" href="group__tablet.html#ga3798b847b682e36ff95826f3aea15e70" title="Initialize a result tablet reader.">virg_tablet_addtail</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *head,
<a name="l00605"></a>00605         <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> **tail, <span class="keywordtype">unsigned</span> possible_rows);
<a name="l00606"></a>00606 <span class="keywordtype">int</span> <a class="code" href="group__tablet.html#ga00875121a2be660a42c7633b13d0e27c" title="Deletes a tablet from memory and disk.">virg_tablet_remove</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keywordtype">unsigned</span> <span class="keywordtype">id</span>);
<a name="l00607"></a>00607 
<a name="l00608"></a>00608 <span class="keywordtype">int</span> <a class="code" href="group__vm.html#ga73e734fd1c2210bd54c01fa03f84e949" title="Add an op to a virtual machine&#39;s statement.">virg_vm_addop</a>(<a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *<a class="code" href="vm__gpu_8cu.html#a946d0d35b3bc20faef9b521a79e7e89a" title="GPU constant memory variable to hold the virtual machine execution context.">vm</a>, <span class="keywordtype">int</span> op, <span class="keywordtype">int</span> p1, <span class="keywordtype">int</span> p2, <span class="keywordtype">int</span> p3, <a class="code" href="unionvirg__var.html" title="Union used to store any of the possible types of virg_t in a single memory location, used for the 4th argument for opcodes.">virg_var</a> p4);
<a name="l00609"></a>00609 <span class="keywordtype">int</span> <a class="code" href="group__vm.html#gae7f94c15491cb88fd9c2325222a40b2c" title="Allocate and create a new result tablet or copy an existing tablet.">virg_vm_allocresult</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *vm,
<a name="l00610"></a>00610         <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> **meta, <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *template_);
<a name="l00611"></a>00611 <span class="keywordtype">int</span> <a class="code" href="group__vm.html#ga7112813a421bcf264ceae71555f18dce" title="Execute the virtual machine using its stored statement.">virg_vm_execute</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *vm);
<a name="l00612"></a>00612 <span class="keywordtype">int</span> <a class="code" href="group__vm.html#gaa7c1110ac7283aac8da00edc168d8252" title="Initialize a result tablet reader.">virg_vm_freeresults</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *vm);
<a name="l00613"></a>00613 <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *<a class="code" href="group__vm.html#ga81b5ae6a1970758a5f3b62f3cabe5e95" title="Initialize a virtual machine context.">virg_vm_init</a>();
<a name="l00614"></a>00614 <span class="keywordtype">void</span> <a class="code" href="group__vm.html#ga62ed45a3768fa86f06a144ddc52852aa" title="Cleanup a virtual machine.">virg_vm_cleanup</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *vm);
<a name="l00615"></a>00615 <span class="keywordtype">void</span> <a class="code" href="group__vm.html#ga5eaa0064c9e2b63ad19d7e3ea95da9c0" title="Execute the data-parallel portion of an opcode program on a single core.">virginia_single</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *vm, <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *tab,
<a name="l00616"></a>00616         <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> **res_, <span class="keywordtype">unsigned</span> row, <span class="keywordtype">unsigned</span> num_rows);
<a name="l00617"></a>00617 <span class="keywordtype">void</span> *<a class="code" href="group__vm.html#gac8a59abde2076fa5dad105b0ec11cf5f" title="Execute the data-parallel portion of an opcode program on multiple cores.">virginia_multi</a>(<span class="keywordtype">void</span> *arg_);
<a name="l00618"></a>00618 <span class="keywordtype">int</span> <a class="code" href="group__vm.html#gaf37b1a607a52750691eb8de389837bd6" title="Chooses and prepares for execution on one or multiple CPU cores.">virg_vm_cpu</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *vm, <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> **tab_,
<a name="l00619"></a>00619         <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> **res, <span class="keywordtype">unsigned</span> num_tablets);
<a name="l00620"></a>00620 <span class="keywordtype">int</span> <a class="code" href="group__vm.html#ga0889e7b22f4c8280651cc5c89c2b29b7" title="Execute the data-parallel portion of an opcode program on a GPU.">virg_vm_gpu</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *vm, <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> **tab_,
<a name="l00621"></a>00621         <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> **res, <span class="keywordtype">unsigned</span> num_tablets);
<a name="l00622"></a>00622 <span class="keyword">const</span> <span class="keywordtype">size_t</span> *<a class="code" href="virginian_8h.html#a43d65f51f2f2fcf918d01efa4e17590d" title="Used in testing to return size test array from gpu-compiled code.">virg_gpu_getsizes</a>();
<a name="l00623"></a>00623 <span class="keyword">const</span> <span class="keywordtype">size_t</span> *<a class="code" href="virginian_8h.html#aac1edfccbd465c2421a276cb9228d09c" title="Used in testing to return size test array from gpu-compiled code.">virg_cpu_getsizes</a>();
<a name="l00624"></a>00624 
<a name="l00625"></a>00625 <span class="keywordtype">int</span> <a class="code" href="group__reader.html#ga8703db2abff6a068f0e032813b42a2bc" title="Initialize a result tablet reader.">virg_reader_init</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a> *r, <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *vm);
<a name="l00626"></a>00626 <span class="keywordtype">int</span> <a class="code" href="group__reader.html#ga6451f1b2ed82890835304dfa28b58dd7" title="Frees the resources used by the reader.">virg_reader_free</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a> *r);
<a name="l00627"></a>00627 <span class="keywordtype">int</span> <a class="code" href="group__reader.html#gae6184dd2665c5545077aa778e2d364c7" title="Get the next result row.">virg_reader_row</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a> *r);
<a name="l00628"></a>00628 <span class="keywordtype">int</span> <a class="code" href="group__reader.html#ga6cd6a8f628268abf736fc4588c6eaf56" title="Print the contents of the reader row buffer to stdout.">virg_reader_print</a>(<a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a> *r);
<a name="l00629"></a>00629 <span class="keywordtype">int</span> <a class="code" href="group__reader.html#gacab24a668844ab54b8b9e1c185ab240f" title="Move the reader to the next tablet.">virg_reader_nexttablet</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a> *r);
<a name="l00630"></a>00630 <span class="keywordtype">int</span> <a class="code" href="group__reader.html#ga99a9065e32d6e59e421599ed52c931ae" title="Count the number of result rows still to be read.">virg_reader_getrows</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a> *r, <span class="keywordtype">unsigned</span> *rows_);
<a name="l00631"></a>00631 
<a name="l00632"></a>00632 <span class="keywordtype">int</span> <a class="code" href="group__virginian.html#gafd19659c526da8b2d82fd4ca0167a28f" title="Parses a SQL query.">virg_sql</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *querystr, <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *vm);
<a name="l00633"></a>00633 
<a name="l00634"></a>00634 <span class="keywordtype">int</span> <a class="code" href="group__virginian.html#gad957409ab5af42ef4fb567ca386880a0" title="Initializes the Virginian database.">virg_init</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v);
<a name="l00635"></a>00635 <span class="keywordtype">int</span> <a class="code" href="group__virginian.html#ga0a9d19e23195be294f562b4ab50dc36e" title="Closes the Virginian database by freeing allocations.">virg_close</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v);
<a name="l00636"></a>00636 <span class="keywordtype">int</span> <a class="code" href="group__virginian.html#gaebf521b283ccb4f30d25c69bcdb5cf7c" title="Executes a SQL query.">virg_query</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a> **reader, <span class="keyword">const</span> <span class="keywordtype">char</span> *query);
<a name="l00637"></a>00637 <span class="keywordtype">void</span> <a class="code" href="group__virginian.html#ga4016938c51ab476124eb67d93dc2f994" title="Cleans up after a SQL query.">virg_release</a>(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__reader.html" title="State of the results reader object.">virg_reader</a> *reader);
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 <span class="keywordtype">size_t</span> virg_sizeof(<a class="code" href="virginian_8h.html#a5edb977d9e195d5df43f1757f311292b" title="enumeration of all variable types used by the database">virg_t</a> type);
<a name="l00640"></a>00640 <span class="keyword">const</span> <span class="keywordtype">char</span>* virg_opstring(<span class="keywordtype">int</span> op);
<a name="l00641"></a>00641 <span class="keywordtype">void</span> virg_print_tablet(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v, <a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *m, <span class="keyword">const</span> <span class="keywordtype">char</span>* filename);
<a name="l00642"></a>00642 <span class="keywordtype">void</span> virg_print_tablet_meta(<a class="code" href="structvirg__tablet__meta.html" title="Tablet meta information.">virg_tablet_meta</a> *m);
<a name="l00643"></a>00643 <span class="keywordtype">void</span> virg_print_stmt(<span class="keyword">const</span> <a class="code" href="structvirg__vm.html" title="State struct of the virtual machine context.">virg_vm</a> *vm);
<a name="l00644"></a>00644 <span class="keywordtype">void</span> virg_print_slots(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v);
<a name="l00645"></a>00645 <span class="keywordtype">void</span> virg_print_tablet_info(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v);
<a name="l00646"></a>00646 <span class="keywordtype">int</span> virg_lock_sum(<a class="code" href="structvirginian.html" title="State struct of the whole database.">virginian</a> *v);
<a name="l00647"></a>00647 <span class="comment"></span>
<a name="l00648"></a>00648 <span class="comment">/// global variable used to store the timer value after virg_timer_start()</span>
<a name="l00649"></a>00649 <span class="comment"></span><span class="keyword">extern</span> <span class="keyword">struct </span>timeval virg_starttime;<span class="comment"></span>
<a name="l00650"></a>00650 <span class="comment">/// global variable used to store the timer value after virg_timer_stop()</span>
<a name="l00651"></a>00651 <span class="comment"></span><span class="keyword">extern</span> <span class="keyword">struct </span>timeval virg_endtime;
<a name="l00652"></a>00652 
<a name="l00653"></a>00653 <span class="keywordtype">void</span> virg_timer_start();
<a name="l00654"></a>00654 <span class="keywordtype">double</span> virg_timer_stop();
<a name="l00655"></a>00655 <span class="keywordtype">double</span> virg_timer_end(<span class="keyword">const</span> <span class="keywordtype">char</span>* label);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00658"></a>00658 <span class="preprocessor"></span>}
<a name="l00659"></a>00659 <span class="preprocessor">#endif</span>
<a name="l00660"></a>00660 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00661"></a>00661 <span class="preprocessor"></span>
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Feb 15 2012 01:21:46 for Virginian by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
